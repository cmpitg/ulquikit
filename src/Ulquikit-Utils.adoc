= Utilities for Ulquikit
:Author: Ha-Duong Nguyen (cmpitg)
:Email: <cmpitg@gmail.com>
:toc: left
:toclevels: 4
:numbered:
:icons: font
:source-highlighter: pygments
:pygments-css: class
:website: http://reference-error.org/projects/ulquikit

Below is the list of utilities/helpers that Ulquikit makes use of.  All of
them are written with simplicity and reusability in mind, while maintaining
relative good performance.

.file::utils.lisp
[source,lisp,linenums]
----
;; include::license-header

(defpackage #:ulqui/utils
  (:use :cl
        :alexandria)
  (:export #:join-lines
           #:->keyword
           #:->string))

(defpackage #:ulqui/utils-tests
  (:use :cl
        :lisp-unit
        :ulqui/utils)
  (:import-from :alexandria :when-let))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Implementation
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(in-package #:ulqui/utils)

(defun join-lines (lines)
  "Joins a list of strings with newline as separator."
  (declare (list lines))
  (the string (format nil "~{~A~^~%~}" lines)))

(in-package #:ulqui/utils-tests)

(define-test test-join-lines
  (assert-equal "" (join-lines '()))
  (assert-equal "a" (join-lines '("a")))
  (assert-equal (format nil "a~%b") (join-lines '("a" "b")))
  (assert-equal (format nil "a~%b~%") (join-lines '("a" "b" ""))))

;; (run-tests '(test-join-lines))

(in-package #:ulqui/utils)

(defun ->keyword (val)
  "Converts a symbol or string into keyword."
  (declare ((or symbol string) val))
  (the keyword (etypecase val
                 (keyword val)
                 (symbol (intern (string-upcase (symbol-name val)) 'keyword))
                 (string (intern (string-upcase val) 'keyword)))))

(defun ->string (val)
  "Converts a symbol or keyword into string."
  (declare ((or symbol string) val))
  (the string (etypecase val
                (string val)
                ((or symbol keyword) (string-downcase (symbol-name val))))))

----

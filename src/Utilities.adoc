= Ulquikit Utilities
:Author: Nguyễn Hà Dương (cmpitg)
:Email: <cmpitg@gmail.com>
:toc:
:numbered:
:icons: font
:source-highlighter: pygments
:pygments-css: class

== General-purpose utilities

General-purpose utility functions.

.file::utils/utils.rkt
[source,racket]
----
;; include::utils/use-rackjure

(provide (all-defined-out))

(define inc (partial + 1))
(define dec #λ(- % 1))

----


== String

.file::utils/string.rkt
[source,racket]
----
;; include::utils/use-rackjure

(require srfi/1)

(require "utils.rkt")

(module+ test
  (require rackunit))

(provide (all-defined-out))

;; include::utils/string/implementation
----

.code::utils/string/implementation
[source,racket]
----
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Implementation
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(define (trim str)
  (let* ([str/list                  (string->list str)]
         [str/list/trim-begin       (drop-while #λ(equal? % #\space)
                                                str/list)]
         [str/list/reversed         (reverse str/list/trim-begin)]
         [str/list/reversed/trimmed (drop-while #λ(equal? % #\space)
                                                str/list/reversed)])
    (~> str/list/reversed/trimmed
      reverse
      list->string)))

(module+ test
  (check-equal? (trim "     ") "")
  (check-equal? (trim "  -  ") "-"))

(define string-ends-with? #λ(regexp-match? (regexp-quote %2) %1))

(define string-rest #λ(~> (string->list %)
                        ((λ (lst)
                           (if (empty? lst)
                               lst
                               (rest lst))))
                        list->string))

(module+ test
  (check-equal? (string-rest "") "")
  (check-equal? (string-rest "a") "")
  (check-equal? (string-rest "ab") "b")
  (check-equal? (string-rest "abc") "bc"))

----


== Path

.file::utils/path.rkt
[source,racket]
----
;; include::utils/use-rackjure

(require racket/path)
(require "string.rkt")

(provide (all-defined-out))

(module+ test
  (require rackunit))

;; include::utils/path/implementation
----

.code::utils/path/implementation
[source,racket]
----
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Implementation
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(define (get-all-adocs path)
  (with-handlers ([exn:fail? (λ (exn) '())])
   (find-files #λ(string-ends-with? % ".adoc") (expand-user-path path))))

(define get-relative-path #λ(simple-form-path (apply build-path %&)))

(define get-directory-path
  #λ(if-let [path (file-name-from-path %)]
      (~>> path
        path->string
        (string-split %)
        first)
      %))

(module+ test
  (check-equal? (get-directory-path "/tmp/tmp.rkt") "/tmp/")
  (check-equal? (get-directory-path "/tmp/tmp/")    "/tmp/tmp/"))

(define create-directory-tree
  #λ(system (format (~a "mkdir -p " %))))

----

== Misc

.code::utils/use-rackjure
[source,racket]
----
#lang rackjure

;; Using hashtable with curly-dict notation
(current-curly-dict hash)
----

== License

.code::utils/license-header
[source,racket]
----
;;
;; This file is part of Ulquikit project.
;;
;; Copyright (C) 2014 Nguyễn Hà Dương <cmpitg AT gmailDOTcom>
;;
;; Ulquikit is free software: you can redistribute it and/or modify it under
;; the terms of the GNU General Public License as published by the Free
;; Software Foundation, either version 3 of the License, or (at your option)
;; any later version.
;;
;; Ulquikit is distributed in the hope that it will be useful, but WITHOUT ANY
;; WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
;; FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
;; details.
;;
;; You should have received a copy of the GNU General Public License along
;; with Ulquikit.  If not, see <http://www.gnu.org/licenses/>.
;;
----

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Nguyễn Hà Dương (cmpitg)">
<title>Ulquikit - How it works</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Ulquikit - How it works</h1>
<div class="details">
<span id="author" class="author">Nguyễn Hà Dương (cmpitg)</span><br>
<span id="email" class="email">&lt;<a href="mailto:cmpitg@gmail.com">cmpitg@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_terminology">1. Terminology</a></li>
<li><a href="#_extracting_and_including_snippets">2. Extracting and including snippets</a></li>
<li><a href="#_anatomy_of_a_ulquikit_command">3. Anatomy of a Ulquikit command</a>
<ul class="sectlevel2">
<li><a href="#_parsing_command_line_arguments_parse_command_args">3.1. Parsing command line arguments parse-command-args</a></li>
<li><a href="#_calling_corresponding_command">3.2. Calling corresponding command</a></li>
<li><a href="#_putting_all_command_things_together">3.3. Putting all command things together</a></li>
</ul>
</li>
<li><a href="#_generating_html">4. Generating HTML</a></li>
<li><a href="#_the_ulqui_script">5. The ulqui script</a></li>
<li><a href="#_managing_ulquikit_source_code">6. Managing Ulquikit source code</a>
<ul class="sectlevel2">
<li><a href="#_generate_source_code_and_html_documents_all_at_once">6.1. Generate source code and HTML documents, all at once</a></li>
<li><a href="#_update_self">6.2. Update-self</a></li>
<li><a href="#_mark_current_source_as_stable">6.3. Mark current source as stable</a></li>
<li><a href="#_release">6.4. Release</a></li>
<li><a href="#_run_current_dev_version_of_ulquikit">6.5. Run current dev version of Ulquikit</a></li>
<li><a href="#_run_tests">6.6. Run tests</a></li>
<li><a href="#_clean_up">6.7. Clean up</a></li>
<li><a href="#_help">6.8. Help</a></li>
<li><a href="#_combine_into_schiffer">6.9. Combine into schiffer</a></li>
</ul>
</li>
<li><a href="#_updating_ulquikit">7. Updating Ulquikit</a>
<ul class="sectlevel2">
<li><a href="#_retrieve_latest_version">7.1. Retrieve latest version</a></li>
<li><a href="#_download_and_replace_ulquikit">7.2. Download and replace Ulquikit</a>
<ul class="sectlevel3">
<li><a href="#_construct_download_url">7.2.1. Construct download URL</a></li>
<li><a href="#_download_and_unzip">7.2.2. Download and unzip</a></li>
</ul>
</li>
<li><a href="#_the_update_command">7.3. The update command</a></li>
</ul>
</li>
<li><a href="#_misc">8. Misc</a>
<ul class="sectlevel2">
<li><a href="#_quick_installation_script">8.1. Quick installation script</a>
<ul class="sectlevel3">
<li><a href="#_make_sure_racket_is_installed">8.1.1. Make sure Racket is installed</a></li>
<li><a href="#_install_ruby_1_9_using_rvm_if_necessary">8.1.2. Install Ruby 1.9 (using RVM) if necessary</a></li>
<li><a href="#_install_asciidoctor_if_necessary">8.1.3. Install AsciiDoctor if necessary</a></li>
<li><a href="#_install_rackjure_if_necessary">8.1.4. Install Rackjure if necessary</a></li>
<li><a href="#_install_ulquikit">8.1.5. Install Ulquikit</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_other_meta_information">9. Other meta-information</a></li>
<li><a href="#_license_header">10. License header</a></li>
<li><a href="#_extras">11. Extras</a></li>
<li><a href="#_utility_functions">12. Utility functions</a>
<ul class="sectlevel2">
<li><a href="#_command_list">12.1. Command list</a></li>
<li><a href="#_story_how_the_racket_version_of_ulquikit_was_actually_developed">12.2. Story: How the Racket version of Ulquikit was actually developed</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Current version:</p>
</div>
<div class="listingblock">
<div class="title">code::ulquikit-version</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">+ulquikit-version+</span> <span class="tok-s2">&quot;0.2.2&quot;</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Ulquikit is written in literate programming itself with a small bootstrap
code.  This document is Ulquikit&#8217;s literate source code.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ulquikit follows
<a href="http://en.wikipedia.org/wiki/Convention_over_configuration">convention over
configuration</a> design.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To compile <em>and run</em> Ulquikit, the following dependencies are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://asciidoctor.org">AsciiDoctor</a></p>
</li>
<li>
<p><a href="http://racket-lang.org">Racket</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ulquikit contains 2 parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrap part: small and straightforward, consists of several Racket files
to extract source code and documents from all AcsciiDoc files in src/</p>
<div class="ulist">
<ul>
<li>
<p>To generate source code, run src/bootstrap/generate-src.rkt</p>
</li>
<li>
<p>To generate documentation, run src/bootstrap/generate-docs.rkt</p>
</li>
</ul>
</div>
</li>
<li>
<p>Main part: this file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s dive into some terminology first</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminology">1. Terminology</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>A <strong>code block</strong> is an AsciiDoc code block.</p>
</li>
<li>
<p>A <strong>snippet</strong> is a code block with Ulquikit-defined title and delimiter
----.  By default, a code block title that starts file:: and code::
defines a <em>file snippet</em> and <em>code snippet</em>, respectively:</p>
<div class="ulist">
<ul>
<li>
<p>A <strong>file snippet</strong> is a snippet producing a source file.</p>
</li>
<li>
<p>A <strong>code snippet</strong> is a snippet storing source code that can be included into
other snippets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>An <strong>include directive</strong> is a line of code that:</p>
<div class="ulist">
<ul>
<li>
<p>belongs to a snippet</p>
</li>
<li>
<p>has the format of xx include::some-snippet-name where xx are two
identical characters denoting a comment.  Ulquikit can recogize the
following comment types: //, ;;, ##, --, or C-stype /*
include::some-snippet-name */, or XML-style &lt;!--
include::some-snippet-name --&gt;.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extracting_and_including_snippets">2. Extracting and including snippets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ulquikit works by searching for all AsciiDoc documents inside
&lt;project-root&gt;/src directory, building a database of snippets, including
them into each other if necessary, then generating documentation and source
code.  Hence, the following functions are probably the most interesting ones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#func/extract-snippets-from-file">extract-snippets-from-file</a>, which
helps extract snippets from a file</p>
</li>
<li>
<p><a href="#func/include-snippet">include-snippet</a>, which helps
<a href="#section/include-snippets">include snippets</a> into each other</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s talk about extract-snippets-from-file first:</p>
</div>
<div class="paragraph">
<p>[[section/extract-snippets]]
=== Extracting snippets</p>
</div>
<div class="paragraph">
<p>The first thing to do is probably to decide how snippets are stored.  This is
very important since every change made to this data structure would affect
code later one.</p>
</div>
<div class="paragraph">
<p>Each snippet is a hash with following format:</p>
</div>
<div id="snippet-format" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-n">snippet-type</span>          <i class="conum" data-value="1"></i><b>(1)</b>
 <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-n">snippet-name</span>          <i class="conum" data-value="2"></i><b>(2)</b>
 <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-n">line-number</span>        <i class="conum" data-value="3"></i><b>(3)</b>
 <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-n">snippet-lines</span>        <i class="conum" data-value="4"></i><b>(4)</b>
 <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-n">processed?</span><span class="tok-p">}</span>     <i class="conum" data-value="5"></i><b>(5)</b>
</td></tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is either 'file or 'code</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>is the name of the snippet; e.g. snippet with title file::something has
something as its name.  Note that snippet name is <em>a string</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>is the line number from the literate source code from where the snippet is
extracted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>is the content of the snippet as a list of lines, this is for performance
purpose</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>determines whether this snippet has been processed? to include others, when
created for the first time, 'processed? is always #f.  It&#8217;s only changed
after the snippet has been passed through
<a href="#include-snippet">include-snippet</a></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Snippets should never be created by directly by using hash.  They
should be created with <a href="#func/create-snippet">create-snippet</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since a snippet stores a list of lines as its content, it&#8217;d be convenient to
have a helper that joins those lines into a complete string:</p>
</div>
<div class="listingblock">
<div class="title">code::get-snippet-content</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-c1">;; lang racket</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-snippet-content</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">string-join</span> <span class="tok-p">(</span><span class="tok-n">%</span> <span class="tok-o">&#39;</span><span class="tok-ss">lines</span><span class="tok-p">)</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>create-snippet is simply implemented as followed:</p>
</div>
<div class="paragraph">
<p>[[func/create-snippet]]
.code::create-snippet</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</div></td><td class="code"><span class="tok-c1">;; #lang racket</span>

<span class="tok-c1">;; include::get-snippet-content</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-n">type</span>
                        <span class="tok-kd">#:name</span> <span class="tok-n">name</span>
                        <span class="tok-kd">#:linenum</span> <span class="tok-n">linenum</span>
                        <span class="tok-kd">#:lines</span> <span class="tok-n">lines</span>
                        <span class="tok-kd">#:processed?</span> <span class="tok-p">[</span><span class="tok-n">processed?</span> <span class="tok-no">#f</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">type</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">symbol?</span> <span class="tok-n">type</span><span class="tok-p">)</span>
                  <span class="tok-n">type</span>
                  <span class="tok-p">(</span><span class="tok-nb">string-&gt;symbol</span> <span class="tok-n">type</span><span class="tok-p">))]</span>
        <span class="tok-p">[</span><span class="tok-n">name</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">symbol?</span> <span class="tok-n">name</span><span class="tok-p">)</span>
                  <span class="tok-p">(</span><span class="tok-nb">symbol-&gt;string</span> <span class="tok-n">name</span><span class="tok-p">)</span>
                  <span class="tok-n">name</span><span class="tok-p">)]</span>
        <span class="tok-p">[</span><span class="tok-n">lines</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">string?</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
                   <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">lines</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span> <span class="tok-kd">#:trim?</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
                   <span class="tok-n">lines</span><span class="tok-p">)])</span>
    <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-n">type</span>
     <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-n">name</span>
     <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-n">linenum</span>
     <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-n">lines</span>
     <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-n">processed?</span><span class="tok-p">}))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                <span class="tok-kd">#:name</span> <span class="tok-o">&#39;</span><span class="tok-ss">hello-world</span>
                                <span class="tok-kd">#:linenum</span> <span class="tok-mi">10</span>
                                <span class="tok-kd">#:lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hmm&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello-world&quot;</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hmm&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">})</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-s2">&quot;string&quot;</span>
                                <span class="tok-kd">#:name</span> <span class="tok-s2">&quot;string&quot;</span>
                                <span class="tok-kd">#:linenum</span> <span class="tok-mi">100</span>
                                <span class="tok-kd">#:lines</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">)</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">string</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;string&quot;</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">100</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;string&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the helper create-snippet is ready.  Let&#8217;s move on to
extract-snippets-from-file.</p>
</div>
<div class="paragraph">
<p>extract-snippets-from-file needs to determine whether <em>a line in a code
block</em> belongs to a <em>code snippet</em>, or <em>file snippet</em>, or none of those; then
extracts the content of the code block and store it if necessary.  Let&#8217;s have
a look at 3 types of code block to see how we could tackle this problem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>code snippet</em> has the following format:</p>
<div class="listingblock">
<div class="content">
<pre>.code::title-of-the-code-block  <i class="conum" data-value="1"></i><b>(1)</b>
[source]                        <i class="conum" data-value="2"></i><b>(2)</b>
----                            <i class="conum" data-value="3"></i><b>(3)</b>
Content of the code block
----                            <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[source]                        <i class="conum" data-value="2"></i><b>(2)</b>
.code::title-of-the-code-block  <i class="conum" data-value="1"></i><b>(1)</b>
----                            <i class="conum" data-value="3"></i><b>(3)</b>
Content of the code block
----                            <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
</li>
<li>
<p>A <em>file snippet</em> shares the same structure as a <em>code snippet</em>:</p>
<div class="listingblock">
<div class="content">
<pre>.file::title-of-the-code-block  <i class="conum" data-value="1"></i><b>(1)</b>
[source]                        <i class="conum" data-value="2"></i><b>(2)</b>
----                            <i class="conum" data-value="3"></i><b>(3)</b>
Content of the code block
----                            <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[source]                        <i class="conum" data-value="2"></i><b>(2)</b>
.file::title-of-the-code-block  <i class="conum" data-value="1"></i><b>(1)</b>
----                            <i class="conum" data-value="3"></i><b>(3)</b>
Content of the code block
----                            <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
</li>
<li>
<p>A non-snippet code block is any block without code::... or file::... as
its title:</p>
<div class="listingblock">
<div class="content">
<pre>[source]                        <i class="conum" data-value="2"></i><b>(2)</b>
----                            <i class="conum" data-value="3"></i><b>(3)</b>
Content of the code block
----                            <i class="conum" data-value="4"></i><b>(4)</b>

....                            <i class="conum" data-value="3"></i><b>(3)</b>
This is a literal block
....                            <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>block title</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>block type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>block delimiter</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>block delimiter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we can clearly see from the 3 examples, <em>code snippets</em> and <em>file snippets</em>
could be determined by checking 2<sup>nd</sup> previous line from block delimiter to
see if it starts with .file:: or .code::.  Everything between the 2
delimiters is stored as the content of the snippet.</p>
</div>
<div class="paragraph">
<p>Hence, we have the following algorithm for extract-snippets-from-file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read the content of a file</p>
</li>
<li>
<p>Break the content into lines preserving line numbers (call string-split
with #:trim? #f).</p>
</li>
<li>
<p>For each line:</p>
<div class="ulist">
<ul>
<li>
<p>If we&#8217;re already inside a snippet:</p>
<div class="ulist">
<ul>
<li>
<p>Complete a snippet and add it to snippet list if current line is a block
delimiter (i.e. ----)</p>
</li>
<li>
<p>Add current line to the current snippet&#8217;s content if current line is not a
block delimiter</p>
</li>
</ul>
</div>
</li>
<li>
<p>If we&#8217;re outside a snippet, we only care if current line is a block
delimiter (i.e. ----):</p>
<div class="ulist">
<ul>
<li>
<p>If this block has a title that marks the beginning of a snippet (i.e. the
2<sup>nd</sup> previous line starts with .file:: or .code::), extract snippet
name and add a new snippet.  Otherwise</p>
</li>
<li>
<p>If this block does not mark the beginning of a snippet, ignore it.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>[[func/extract-snippets-from-file]]
.code::extract-snippets-from-file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</div></td><td class="code"><span class="tok-c1">;; include::extract-snippets-from-file-helpers</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">extract-snippets-from-file</span> <span class="tok-n">path</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">file-content</span> <span class="tok-p">(</span><span class="tok-n">read-file</span> <span class="tok-n">path</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">lines</span>        <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">file-content</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span> <span class="tok-kd">#:trim?</span> <span class="tok-no">#f</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">snippets</span>        <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                                      <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{}})]</span>

         <span class="tok-p">[</span><span class="tok-n">prev-prev-line</span>  <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">prev-line</span>       <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">snippet-type</span>    <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-nb">null</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">snippet-lines</span>   <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-o">&#39;</span><span class="tok-p">())]</span>
         <span class="tok-p">[</span><span class="tok-n">snippet-name</span>    <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">snippet-linenum</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-mi">0</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">inside-snippet</span>  <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-no">#f</span><span class="tok-p">)])</span>

    <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([</span><span class="tok-n">line-num</span>    <span class="tok-p">(</span><span class="tok-nb">in-naturals</span> <span class="tok-mi">1</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">line</span>        <span class="tok-p">(</span><span class="tok-nb">in-list</span> <span class="tok-n">lines</span><span class="tok-p">)])</span>

      <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-k">and</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">inside-snippet</span><span class="tok-p">)</span>
                  <span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-n">line</span><span class="tok-p">)))</span>

             <span class="tok-p">(</span><span class="tok-n">box-swap!</span> <span class="tok-n">snippet-lines</span> <span class="tok-nb">append</span> <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-n">line</span><span class="tok-p">))]</span>

            <span class="tok-p">[(</span><span class="tok-k">and</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">inside-snippet</span><span class="tok-p">)</span>
                  <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-n">line</span><span class="tok-p">))</span>

             <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">inside-snippet</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
             <span class="tok-p">(</span><span class="tok-n">box-swap!</span> <span class="tok-n">snippets</span>
                        <span class="tok-n">add-snippets</span>
                        <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippet-type</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:name</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippet-name</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:linenum</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippet-linenum</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:lines</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippet-lines</span><span class="tok-p">)))]</span>
            <span class="tok-p">[(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-n">line</span><span class="tok-p">)</span>

             <span class="tok-p">(</span><span class="tok-k">when</span> <span class="tok-p">(</span><span class="tok-k">or</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-prev-line</span><span class="tok-p">))</span>
                       <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-line</span><span class="tok-p">)))</span>
               <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">title-line</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-prev-line</span><span class="tok-p">))</span>
                                     <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-prev-line</span><span class="tok-p">)</span>
                                     <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-line</span><span class="tok-p">))])</span>
                 <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">inside-snippet</span> <span class="tok-no">#t</span><span class="tok-p">)</span>

                 <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">snippet-type</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-type</span> <span class="tok-n">title-line</span><span class="tok-p">))</span>
                 <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">snippet-name</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-name</span> <span class="tok-n">title-line</span><span class="tok-p">))</span>
                 <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">snippet-lines</span> <span class="tok-o">&#39;</span><span class="tok-p">())</span>
                 <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">snippet-linenum</span> <span class="tok-p">(</span><span class="tok-n">dec</span> <span class="tok-n">line-num</span><span class="tok-p">))))])</span>

      <span class="tok-c1">;; Always update previous line</span>
      <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">prev-prev-line</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">prev-line</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-n">box-set!</span> <span class="tok-n">prev-line</span>      <span class="tok-n">line</span><span class="tok-p">))</span>

    <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippets</span><span class="tok-p">)))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, for extract-snippets-from-file to function, the following helpers are
necessary:</p>
</div>
<div class="listingblock">
<div class="title">code::extract-snippets-from-file-helpers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">is-block-delimiter?</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">regexp-match?</span> <span class="tok-sr">#rx&quot;^----( *)$&quot;</span> <span class="tok-n">%</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-s2">&quot;----&quot;</span><span class="tok-p">)</span>    <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-s2">&quot; ----&quot;</span><span class="tok-p">)</span>   <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-s2">&quot;---- &quot;</span><span class="tok-p">)</span>   <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-s2">&quot;----  &quot;</span><span class="tok-p">)</span>  <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-delimiter?</span> <span class="tok-s2">&quot;----a&quot;</span><span class="tok-p">)</span>   <span class="tok-no">#f</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">is-block-title?</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">regexp-match?</span> <span class="tok-sr">#rx&quot;^\\.(file|code)::&quot;</span> <span class="tok-n">%</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-s2">&quot;.file::something&quot;</span><span class="tok-p">)</span>       <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-s2">&quot;.file::something else&quot;</span><span class="tok-p">)</span>  <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-s2">&quot;.file::&quot;</span><span class="tok-p">)</span>                <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-block-title?</span> <span class="tok-s2">&quot;.file:something&quot;</span><span class="tok-p">)</span>        <span class="tok-no">#f</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-snippet-type</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-n">string-rest</span> <span class="tok-n">%</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-s2">&quot;::&quot;</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">list-ref</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
      <span class="tok-nb">string-&gt;symbol</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-type</span> <span class="tok-s2">&quot;.file::&quot;</span><span class="tok-p">)</span>  <span class="tok-o">&#39;</span><span class="tok-ss">file</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-type</span> <span class="tok-s2">&quot;.code::&quot;</span><span class="tok-p">)</span>  <span class="tok-o">&#39;</span><span class="tok-ss">code</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-snippet-name</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-n">string-rest</span> <span class="tok-n">%</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-s2">&quot;::&quot;</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">append</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">list-ref</span> <span class="tok-mi">1</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-name</span> <span class="tok-s2">&quot;.file::&quot;</span><span class="tok-p">)</span>     <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-name</span> <span class="tok-s2">&quot;.code::&quot;</span><span class="tok-p">)</span>     <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-name</span> <span class="tok-s2">&quot;.file::abc&quot;</span><span class="tok-p">)</span>  <span class="tok-s2">&quot;abc&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-name</span> <span class="tok-s2">&quot;.code::a b&quot;</span><span class="tok-p">)</span>  <span class="tok-s2">&quot;a b&quot;</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">add-snippets</span> <span class="tok-n">snippets</span> <span class="tok-n">snippet</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">type</span> <span class="tok-p">(</span><span class="tok-n">snippet</span> <span class="tok-o">&#39;</span><span class="tok-ss">type</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">name</span> <span class="tok-p">(</span><span class="tok-n">snippet</span> <span class="tok-o">&#39;</span><span class="tok-ss">name</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">snippets/typed</span>         <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-n">type</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">snippets/typed/updated</span> <span class="tok-p">(</span><span class="tok-n">snippets/typed</span> <span class="tok-n">name</span> <span class="tok-n">snippet</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-n">type</span> <span class="tok-n">snippets/typed/updated</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">add-snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{}}</span>
                              <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                              <span class="tok-kd">#:name</span> <span class="tok-o">&#39;</span><span class="tok-ss">hello</span>
                                              <span class="tok-kd">#:linenum</span> <span class="tok-mi">10</span>
                                              <span class="tok-kd">#:lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something&quot;</span><span class="tok-p">)))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something&quot;</span><span class="tok-p">)</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">add-snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                               <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something&quot;</span><span class="tok-p">)</span>
                                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{}}</span>
                              <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                              <span class="tok-kd">#:name</span> <span class="tok-o">&#39;</span><span class="tok-ss">say-something</span>
                                              <span class="tok-kd">#:linenum</span> <span class="tok-mi">100</span>
                                              <span class="tok-kd">#:lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something else&quot;</span><span class="tok-p">)))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something&quot;</span><span class="tok-p">)</span>
                                 <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;say-something&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                         <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;say-something&quot;</span>
                                         <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">100</span>
                                         <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Something else&quot;</span><span class="tok-p">)</span>
                                         <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}}))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result, extract-snippets, which extracts snippets from all AsciiDoc
documents in a directory recursively, makes use of
extract-snippets-from-file to function.  extract-snippets takes a path and
return a hash of following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-n">file-snippets-hash</span>
 <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-n">code-snippets-hash</span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>file-snippets-hash and code-snippets-hash follow <a href="#snippet-format">snippet
format</a> defined above.</p>
</div>
<div class="listingblock">
<div class="title">code::extract-snippets</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</div></td><td class="code"><span class="tok-c1">;; include::extract-snippets-from-file</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">extract-snippets</span> <span class="tok-n">from-dir</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">for/fold</span> <span class="tok-p">([</span><span class="tok-n">snippet</span> <span class="tok-p">{}])</span>
      <span class="tok-p">([</span><span class="tok-k">file</span> <span class="tok-p">(</span><span class="tok-n">list-all-adocs</span> <span class="tok-p">(</span><span class="tok-n">standardize-path</span> <span class="tok-n">from-dir</span><span class="tok-p">))])</span>
    <span class="tok-p">(</span><span class="tok-n">dict-merge</span> <span class="tok-n">snippet</span> <span class="tok-p">(</span><span class="tok-n">extract-snippets-from-file</span> <span class="tok-k">file</span><span class="tok-p">))))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">temp-dir</span> <span class="tok-p">(</span><span class="tok-n">get-relative-path</span> <span class="tok-p">(</span><span class="tok-n">get-temp-dir</span><span class="tok-p">)</span>
                                      <span class="tok-s2">&quot;./ulqui-extract-snippets&quot;</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">expected-code-snippets</span>
          <span class="tok-p">{</span><span class="tok-s2">&quot;main-program&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                           <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;;; include::utils&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span>
                             <span class="tok-s2">&quot;(module+ main&quot;</span>
                             <span class="tok-s2">&quot;  (displayln (string-reverse </span><span class="tok-se">\&quot;</span><span class="tok-s2">¡Hola mundo!</span><span class="tok-se">\&quot;</span><span class="tok-s2">)))&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
                           <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)</span>
           <span class="tok-s2">&quot;use-rackjure&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                           <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;#lang rackjure&quot;</span>
                             <span class="tok-s2">&quot;(current-curly-dict hash)&quot;</span><span class="tok-p">)</span>
                           <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)</span>
           <span class="tok-s2">&quot;license-header&quot;</span> <span class="tok-s2">&quot;;; Just a sample license header.&quot;</span>
           <span class="tok-s2">&quot;utils&quot;</span> <span class="tok-s2">&quot;;; include::utils-string&quot;</span>
           <span class="tok-s2">&quot;utils-string&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                           <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;(define (string-reverse str)&quot;</span>
                             <span class="tok-s2">&quot;  (~&gt; (string-&gt;list str)&quot;</span>
                             <span class="tok-s2">&quot;    reverse&quot;</span>
                             <span class="tok-s2">&quot;    list-&gt;string))&quot;</span><span class="tok-p">)</span>
                           <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)}]</span>

         <span class="tok-p">[</span><span class="tok-n">expected-file-snippets</span>
          <span class="tok-p">{</span><span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                           <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;;; include::license-header&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span>
                             <span class="tok-s2">&quot;;; include::use-rackjure&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span>
                             <span class="tok-s2">&quot;;; include::main-program&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span>
                             <span class="tok-s2">&quot;== Main program&quot;</span>
                             <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
                           <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)}]</span>

         <span class="tok-p">[</span><span class="tok-n">file-list</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Main&quot;</span>
                      <span class="tok-s2">&quot;License&quot;</span>
                      <span class="tok-s2">&quot;inside/Utils&quot;</span>
                      <span class="tok-s2">&quot;inside/Utils-String&quot;</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">source-files</span> <span class="tok-p">(</span><span class="tok-k">for/list</span> <span class="tok-p">([</span><span class="tok-n">name</span> <span class="tok-p">(</span><span class="tok-nb">in-list</span> <span class="tok-n">file-list</span><span class="tok-p">)])</span>
                         <span class="tok-p">(</span><span class="tok-n">get-relative-path</span> <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;~a./~a.adoc&quot;</span>
                                                    <span class="tok-n">temp-dir</span>
                                                    <span class="tok-n">name</span><span class="tok-p">)))]</span>
         <span class="tok-p">[</span><span class="tok-n">content</span>
          <span class="tok-p">{</span><span class="tok-s2">&quot;Main&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                   <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-s2">&quot;= A document&quot;</span>
                         <span class="tok-s2">&quot;&quot;</span>
                         <span class="tok-s2">&quot;Just a hello world program&quot;</span>
                         <span class="tok-s2">&quot;&quot;</span>
                         <span class="tok-s2">&quot;[source,racket,linenums]&quot;</span>
                         <span class="tok-s2">&quot;.file::/tmp/tmp.rkt&quot;</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-p">(</span><span class="tok-n">expected-file-snippets</span> <span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span><span class="tok-p">)</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-s2">&quot;.code::main-program&quot;</span>
                         <span class="tok-s2">&quot;[source,racket,linenums]&quot;</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-s2">&quot;main-program&quot;</span><span class="tok-p">)</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-s2">&quot;.code::use-rackjure&quot;</span>
                         <span class="tok-s2">&quot;[source]&quot;</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-s2">&quot;use-rackjure&quot;</span><span class="tok-p">)</span>
                         <span class="tok-s2">&quot;----&quot;</span>
                         <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
                   <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)</span>
           <span class="tok-s2">&quot;License&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                      <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-s2">&quot;= License header&quot;</span>
                            <span class="tok-s2">&quot;&quot;</span>
                            <span class="tok-s2">&quot;.code::license-header&quot;</span>
                            <span class="tok-s2">&quot;[source,racket]&quot;</span>
                            <span class="tok-s2">&quot;----&quot;</span>
                            <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-s2">&quot;license-header&quot;</span><span class="tok-p">)</span>
                            <span class="tok-s2">&quot;----&quot;</span><span class="tok-p">)</span>
                      <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)</span>
           <span class="tok-s2">&quot;inside/Utils&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                           <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-s2">&quot;= Utils&quot;</span>
                                 <span class="tok-s2">&quot;&quot;</span>
                                 <span class="tok-s2">&quot;Right now, we just want to include string utililities.&quot;</span>
                                 <span class="tok-s2">&quot;&quot;</span>
                                 <span class="tok-s2">&quot;.code::utils&quot;</span>
                                 <span class="tok-s2">&quot;[source,racket,linenums]&quot;</span>
                                 <span class="tok-s2">&quot;----&quot;</span>
                                 <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-s2">&quot;utils&quot;</span><span class="tok-p">)</span>
                                 <span class="tok-s2">&quot;----&quot;</span><span class="tok-p">)</span>
                           <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)</span>
           <span class="tok-s2">&quot;inside/Utils-String&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-join</span>
                                  <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-s2">&quot;= String Utilities&quot;</span>
                                        <span class="tok-s2">&quot;&quot;</span>
                                        <span class="tok-s2">&quot;.code::utils-string&quot;</span>
                                        <span class="tok-s2">&quot;[source,racket,linenums]&quot;</span>
                                        <span class="tok-s2">&quot;----&quot;</span>
                                        <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-s2">&quot;utils-string&quot;</span><span class="tok-p">)</span>
                                        <span class="tok-s2">&quot;----&quot;</span><span class="tok-p">)</span>
                                  <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)}])</span>
    <span class="tok-p">(</span><span class="tok-k">with-handlers</span> <span class="tok-p">([</span><span class="tok-nb">exn:fail?</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">remove-dir</span> <span class="tok-n">temp-dir</span><span class="tok-p">)])</span>
      <span class="tok-p">(</span><span class="tok-n">remove-dir</span> <span class="tok-n">temp-dir</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-n">create-dir</span> <span class="tok-p">(</span><span class="tok-n">get-relative-path</span> <span class="tok-n">temp-dir</span>
                                     <span class="tok-s2">&quot;./inside&quot;</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([(</span><span class="tok-n">filename</span> <span class="tok-n">content</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-nb">in-hash</span> <span class="tok-n">content</span><span class="tok-p">)])</span>
        <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">path</span> <span class="tok-p">(</span><span class="tok-n">get-relative-path</span> <span class="tok-n">temp-dir</span>
                                       <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;./~a.adoc&quot;</span> <span class="tok-n">filename</span><span class="tok-p">))])</span>
          <span class="tok-p">(</span><span class="tok-nb">display-to-file</span> <span class="tok-n">content</span> <span class="tok-n">path</span><span class="tok-p">)))</span>

      <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">snippets</span> <span class="tok-p">(</span><span class="tok-n">extract-snippets</span> <span class="tok-n">temp-dir</span><span class="tok-p">)]</span>
             <span class="tok-p">[</span><span class="tok-n">code-snippet</span> <span class="tok-p">(</span><span class="tok-n">get-code-snippets</span> <span class="tok-n">snippets</span><span class="tok-p">)]</span>
             <span class="tok-p">[</span><span class="tok-n">file-snippet</span> <span class="tok-p">(</span><span class="tok-n">get-file-snippets</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>

        <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([(</span><span class="tok-n">name</span> <span class="tok-n">snippet</span><span class="tok-p">)</span> <span class="tok-n">code-snippet</span><span class="tok-p">])</span>
          <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-content</span> <span class="tok-n">snippet</span><span class="tok-p">)</span>
                        <span class="tok-p">(</span><span class="tok-n">expected-code-snippets</span> <span class="tok-n">name</span><span class="tok-p">)))</span>

        <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([(</span><span class="tok-n">name</span> <span class="tok-n">snippet</span><span class="tok-p">)</span> <span class="tok-n">file-snippet</span><span class="tok-p">])</span>
          <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-content</span> <span class="tok-n">snippet</span><span class="tok-p">)</span>
                        <span class="tok-p">(</span><span class="tok-n">expected-file-snippets</span> <span class="tok-n">name</span><span class="tok-p">))))</span>
      <span class="tok-p">(</span><span class="tok-n">remove-dir</span> <span class="tok-n">temp-dir</span><span class="tok-p">))))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>After extract-snippets, the next important function is include-snippet,
which is use to include other snippets into one targeted snippet.  Let&#8217;s see
how we could implement it.</p>
</div>
<div class="paragraph">
<p>[[section/include-snippets]]
=== Including snippets into each other</p>
</div>
<div class="paragraph">
<p>include-snippet should take 2 arguments: a hash containing all snippets,
and the snippet which needs to be checked and included.  Thus this function
has the following signature: (include-snippet snippets target)
include-snippet working by browsing its content, one line at a time, then
replace the line with include directive with the corresponding <em>code
snippet</em>.  If no snippet is found, leave that line as-is.</p>
</div>
<div class="paragraph">
<p>Note that there are a couple things to bring into concern there:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Snippet A includes snippet B, snippets B includes snippets C and D.  So the
best scenario is to include C and D into B while we&#8217;re actually
processing A.  I.e. include-snippet should be recursive to accumulate the
results.</p>
</li>
<li>
<p>Also because of the above reason, snippets should be able to receive the
changes across all calls recursive to include-snippet.  I.e. consider
this dummy, incorrect implementation:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">snippets</span> <span class="tok-n">target</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">unless</span> <span class="tok-p">(</span><span class="tok-nb">=</span> <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-o">&#39;</span><span class="tok-ss">a</span><span class="tok-p">)</span> <span class="tok-mi">12</span><span class="tok-p">)</span>
    <span class="tok-c1">;; Increase (snippets &#39;a)</span>
    <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">snippets</span> <span class="tok-n">new-target</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">a</span> <span class="tok-mi">10</span><span class="tok-p">}])</span>
 <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">snippets</span> <span class="tok-n">some-target</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-o">&#39;</span><span class="tok-ss">a</span><span class="tok-p">))</span>
<span class="tok-c1">;; ⇨ 12</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see after returning from any call, the value of snippets should be
changed as it is changed inside those calls.</p>
</div>
<div class="paragraph">
<p>One of the solutions for this is to construct a helper and put snippets into
a box to make it safely immutable, then change it value for each time the
helper is call.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">box and mutability</div>
This is a perfect example of safe use mutable values in combination with
<a href="http://docs.racket-lang.org/reference/boxes.html">box</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Snippet A includes snippet B, then snippet B includes snippet A again,
creating circular dependency.  To prevent this, a list of currently included
snippet must be kept track of.  If a snippet has already been in the track,
include it but don&#8217;t process it.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In case of circular dependency, the results are <strong>unexpected</strong>.  Thus,
make sure snippets are well-managed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Henceforth, our helper will takes the signature: (process-include-snippet
target track)</p>
</div>
<div class="paragraph">
<p>With all the reasons stated above, we have this implementation:</p>
</div>
<div class="paragraph">
<p>[[func/include-snippet]]
.code::include-snippet</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</div></td><td class="code"><span class="tok-c1">;; lang racket</span>

<span class="tok-c1">;; include::include-snippet-helpers</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span>
                         <span class="tok-n">target</span>
                         <span class="tok-p">[</span><span class="tok-n">included?</span> <span class="tok-p">{}])</span>
  <span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">updated-included?</span> <span class="tok-p">(</span><span class="tok-n">included?</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">name</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">))</span>
  <span class="tok-p">(</span><span class="tok-k">unless</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span><span class="tok-p">)</span>
    <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">lines</span>
            <span class="tok-p">(</span><span class="tok-k">for/list</span> <span class="tok-p">([</span><span class="tok-n">line</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">lines</span><span class="tok-p">)])</span>
              <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-n">line</span><span class="tok-p">)</span>
                  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">included-snippet-name</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-n">line</span><span class="tok-p">)]</span>
                         <span class="tok-p">[</span><span class="tok-n">snippet-to-include</span>    <span class="tok-p">(</span><span class="tok-n">get-snippet-by-name</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)</span>
                                                                     <span class="tok-n">included-snippet-name</span><span class="tok-p">)])</span>
                    <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-k">or</span> <span class="tok-p">(</span><span class="tok-n">updated-included?</span> <span class="tok-n">included-snippet-name</span><span class="tok-p">)</span>
                               <span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-n">snippet-to-include</span><span class="tok-p">))</span>

                           <span class="tok-c1">;; This snippet has already been included on the</span>
                           <span class="tok-c1">;; track or there&#39;s no such snippet ⇨ do nothing</span>
                           <span class="tok-n">line</span><span class="tok-p">]</span>

                          <span class="tok-p">[(</span><span class="tok-n">snippet-to-include</span> <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span><span class="tok-p">)</span>

                           <span class="tok-c1">;; When the snippet is already processed, simply</span>
                           <span class="tok-c1">;; return it</span>
                           <span class="tok-p">(</span><span class="tok-nb">string-join</span> <span class="tok-p">(</span><span class="tok-n">snippet-to-include</span> <span class="tok-o">&#39;</span><span class="tok-ss">lines</span><span class="tok-p">)</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)]</span>

                          <span class="tok-p">[</span><span class="tok-k">else</span>

                           <span class="tok-c1">;; When the snippet we&#39;re about to include exists</span>
                           <span class="tok-c1">;; and hasn&#39;t been processed</span>
                           <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span>
                                            <span class="tok-n">snippet-to-include</span>
                                            <span class="tok-p">(</span><span class="tok-n">updated-included?</span> <span class="tok-n">included-snippet-name</span> <span class="tok-no">#t</span><span class="tok-p">))</span>

                           <span class="tok-c1">;; Of course, then we must return it after</span>
                           <span class="tok-c1">;; processed</span>
                           <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-by-name</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)</span>
                                                    <span class="tok-n">included-snippet-name</span><span class="tok-p">)</span>
                             <span class="tok-o">&#39;</span><span class="tok-ss">lines</span>
                             <span class="tok-p">(</span><span class="tok-nb">string-join</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">))]))</span>

                  <span class="tok-n">line</span><span class="tok-p">))]</span>

           <span class="tok-p">[</span><span class="tok-n">new-snippet</span> <span class="tok-p">(</span><span class="tok-n">create-snippet</span> <span class="tok-kd">#:type</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">type</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:name</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">name</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:linenum</span> <span class="tok-p">(</span><span class="tok-n">target</span> <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span><span class="tok-p">)</span>
                                        <span class="tok-kd">#:lines</span> <span class="tok-n">lines</span>
                                        <span class="tok-kd">#:processed?</span> <span class="tok-no">#t</span><span class="tok-p">)])</span>
      <span class="tok-p">(</span><span class="tok-n">update-snippet/boxed</span> <span class="tok-n">boxed</span> <span class="tok-n">new-snippet</span><span class="tok-p">))))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">file-snippet-tmp</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span>
                            <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                            <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;;; include::A&quot;</span><span class="tok-p">)</span>
                            <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span><span class="tok-p">}]</span>
         <span class="tok-p">[</span><span class="tok-n">snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{</span><span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span> <span class="tok-n">file-snippet-tmp</span><span class="tok-p">}</span>
                    <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;;; include::B&quot;</span><span class="tok-p">)</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span><span class="tok-p">}</span>
                           <span class="tok-s2">&quot;B&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;B&quot;</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hello&quot;</span><span class="tok-p">)</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span><span class="tok-p">}</span>
                           <span class="tok-s2">&quot;C&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;C&quot;</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Unprocessed&quot;</span><span class="tok-p">)</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}}]</span>
         <span class="tok-p">[</span><span class="tok-n">boxed</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span> <span class="tok-n">file-snippet-tmp</span> <span class="tok-p">{})</span>
    <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)</span>
                  <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{</span><span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;/tmp/tmp.rkt&quot;</span>
                                          <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span>
                                          <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World</span><span class="tok-se">\n</span><span class="tok-s2">Hello&quot;</span><span class="tok-p">)</span>
                                          <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                                          <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}}</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;Hello&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}</span>
                          <span class="tok-s2">&quot;B&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;B&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hello&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}</span>
                          <span class="tok-s2">&quot;C&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;C&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Unprocessed&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}}))</span>

  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">snippet-a</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;;; include::B&quot;</span><span class="tok-p">)</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span><span class="tok-p">}]</span>
         <span class="tok-p">[</span><span class="tok-n">snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                    <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-n">snippet-a</span>
                           <span class="tok-s2">&quot;B&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;B&quot;</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hello&quot;</span> <span class="tok-s2">&quot;;; include::A&quot;</span><span class="tok-p">)</span>
                                <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span><span class="tok-p">}}}]</span>
         <span class="tok-p">[</span><span class="tok-n">boxed</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span> <span class="tok-n">snippet-a</span> <span class="tok-p">{})</span>
    <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)</span>
                  <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;Hello</span><span class="tok-se">\n</span><span class="tok-s2">;; include::A&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}</span>
                          <span class="tok-s2">&quot;B&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;B&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hello&quot;</span> <span class="tok-s2">&quot;;; include::A&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">30</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}}}))</span>

  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">snippet-a</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;;; include::B&quot;</span><span class="tok-p">)</span>
                     <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span><span class="tok-p">}]</span>
         <span class="tok-p">[</span><span class="tok-n">snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                    <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-n">snippet-a</span><span class="tok-p">}}]</span>
         <span class="tok-p">[</span><span class="tok-n">boxed</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span> <span class="tok-n">snippet-a</span> <span class="tok-p">{})</span>
    <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)</span>
                  <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;A&quot;</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;World&quot;</span> <span class="tok-s2">&quot;;; include::B&quot;</span><span class="tok-p">)</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span>
                               <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}}})))</span>

<span class="tok-c1">;; (define (include-snippet snippets target)</span>
<span class="tok-c1">;;   (let* ([boxed (box snippets)]</span>
<span class="tok-c1">;;          [snippet-name (target &#39;name)])</span>
<span class="tok-c1">;;     (include-snippet boxed</span>
<span class="tok-c1">;;                              #:name snippet-name</span>
<span class="tok-c1">;;                              #:included {})))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see, include-snippet makes use of a lot of helpers.  All of them
are short and easily implemented like so:</p>
</div>
<div class="listingblock">
<div class="title">code::include-snippet-helpers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">update-snippet/boxed</span> <span class="tok-n">snippets/box</span> <span class="tok-n">snippet</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">type</span> <span class="tok-p">(</span><span class="tok-n">snippet</span> <span class="tok-o">&#39;</span><span class="tok-ss">type</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">name</span> <span class="tok-p">(</span><span class="tok-n">snippet</span> <span class="tok-o">&#39;</span><span class="tok-ss">name</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">box-swap!</span> <span class="tok-n">snippets/box</span>
               <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">(</span><span class="tok-n">snippets</span><span class="tok-p">)</span>
                 <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">snippets/typed</span> <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-n">type</span><span class="tok-p">)]</span>
                        <span class="tok-p">[</span><span class="tok-n">snippets/typed/updated</span> <span class="tok-p">(</span><span class="tok-n">snippets/typed</span> <span class="tok-n">name</span> <span class="tok-n">snippet</span><span class="tok-p">)]</span>
                        <span class="tok-p">[</span><span class="tok-n">snippets/updated</span> <span class="tok-p">(</span><span class="tok-n">snippets</span> <span class="tok-n">type</span> <span class="tok-n">snippets/typed/updated</span><span class="tok-p">)])</span>
                   <span class="tok-n">snippets/updated</span><span class="tok-p">)))))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">snippets</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                    <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                    <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                                    <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;original&quot;</span><span class="tok-p">)</span>
                                    <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">20</span>
                                    <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#f</span><span class="tok-p">}}}]</span>
         <span class="tok-p">[</span><span class="tok-n">snippets/box</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">update-snippet/boxed</span> <span class="tok-n">snippets/box</span>
                          <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                           <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                           <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;changed&quot;</span><span class="tok-p">)</span>
                           <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                           <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">})</span>
    <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">snippets/box</span><span class="tok-p">)</span>
                  <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-p">{}</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-p">{</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span>
                                   <span class="tok-o">&#39;</span><span class="tok-ss">name</span> <span class="tok-s2">&quot;hello&quot;</span>
                                   <span class="tok-o">&#39;</span><span class="tok-ss">lines</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;changed&quot;</span><span class="tok-p">)</span>
                                   <span class="tok-o">&#39;</span><span class="tok-ss">linenum</span> <span class="tok-mi">10</span>
                                   <span class="tok-o">&#39;</span><span class="tok-ss">processed?</span> <span class="tok-no">#t</span><span class="tok-p">}}})))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">is-include-directive?</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-k">or</span> <span class="tok-p">(</span><span class="tok-nb">regexp-match?</span> <span class="tok-sr">#px&quot;^[#;/-]{2} include::.*&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-trim</span> <span class="tok-n">%</span><span class="tok-p">))</span>
        <span class="tok-p">(</span><span class="tok-nb">regexp-match?</span> <span class="tok-sr">#px&quot;^&lt;!-- include::.* --&gt;&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-trim</span> <span class="tok-n">%</span><span class="tok-p">))</span>
        <span class="tok-p">(</span><span class="tok-nb">regexp-match?</span> <span class="tok-sr">#px&quot;^/\\* include::.* \\*/&quot;</span> <span class="tok-p">(</span><span class="tok-nb">string-trim</span> <span class="tok-n">%</span><span class="tok-p">))))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;  ;; include::&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;;; include::&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;a;; include::&quot;</span><span class="tok-p">)</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;;; include::something&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;## include::something&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;// include::something&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;/* include::something */&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;&lt;!-- include::something --&gt;&quot;</span><span class="tok-p">)</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-s2">&quot;a &lt;!-- include::something --&gt;&quot;</span><span class="tok-p">)</span> <span class="tok-no">#f</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-n">line</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">is-include-directive?</span> <span class="tok-n">line</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">line</span> <span class="tok-p">(</span><span class="tok-nb">string-trim</span> <span class="tok-n">line</span><span class="tok-p">)]</span>
             <span class="tok-p">[</span><span class="tok-n">line-2</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">string-ends-with?</span> <span class="tok-n">line</span> <span class="tok-s2">&quot; --&gt;&quot;</span><span class="tok-p">)</span>
                         <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">line</span> <span class="tok-s2">&quot; --&gt;&quot;</span><span class="tok-p">))</span>
                         <span class="tok-n">line</span><span class="tok-p">)]</span>
             <span class="tok-p">[</span><span class="tok-n">line-3</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">string-ends-with?</span> <span class="tok-n">line-2</span> <span class="tok-s2">&quot; */&quot;</span><span class="tok-p">)</span>
                         <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">line-2</span> <span class="tok-s2">&quot; */&quot;</span><span class="tok-p">))</span>
                         <span class="tok-n">line-2</span><span class="tok-p">)]</span>
             <span class="tok-p">[</span><span class="tok-n">splitted</span> <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">line-3</span> <span class="tok-s2">&quot;include::&quot;</span><span class="tok-p">)])</span>
        <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">&gt;</span> <span class="tok-p">(</span><span class="tok-nb">length</span> <span class="tok-n">splitted</span><span class="tok-p">)</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
            <span class="tok-p">(</span><span class="tok-nb">last</span> <span class="tok-n">splitted</span><span class="tok-p">)</span>
            <span class="tok-s2">&quot;&quot;</span><span class="tok-p">))</span>
      <span class="tok-s2">&quot;&quot;</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;  ;; include::&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;;; include::&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;;; include::something&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;something&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;## include::something&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;something&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;// include::something&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;something&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;/* include::something */&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;something&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;&lt;!-- include::something --&gt;&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;something&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-included-snippet-name</span> <span class="tok-s2">&quot;a &lt;!-- include::something --&gt;&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-by-name</span> <span class="tok-n">snippets</span>
                             <span class="tok-n">name</span>
                             <span class="tok-kd">#:type</span> <span class="tok-p">[</span><span class="tok-n">type</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-n">snippets</span> <span class="tok-n">type</span> <span class="tok-n">name</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And that concludes the most important functions of Ulquikit.  Those functions
are used to implement the <a href="#section/generate-source">generate-src</a> right below.</p>
</div>
<div class="paragraph">
<p>[[command/generate-src]]
== Generating source code</p>
</div>
<div class="paragraph">
<p>Once snippets are extracted and included into each other, the act of
generateing source code becomes trivial, as implemented in generate-src
below.</p>
</div>
<div class="listingblock">
<div class="title">code::generate-src</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-c1">;; lang racket</span>

<span class="tok-c1">;; include::create-snippet</span>

<span class="tok-c1">;; include::extract-snippets</span>

<span class="tok-c1">;; include::include-snippet</span>

<span class="tok-c1">;; include::generate-snippets-helpers</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-src</span> <span class="tok-kd">#:from</span> <span class="tok-p">[</span><span class="tok-n">from</span> <span class="tok-s2">&quot;src&quot;</span><span class="tok-p">]</span>
                      <span class="tok-kd">#:to</span>   <span class="tok-p">[</span><span class="tok-n">to</span>   <span class="tok-s2">&quot;generated-src&quot;</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">from</span> <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">from</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">to</span>   <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">to</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">file-exists?</span> <span class="tok-n">from</span><span class="tok-p">)</span>
            <span class="tok-p">(</span><span class="tok-n">extract-snippets-from-file</span> <span class="tok-n">from</span><span class="tok-p">)</span>
            <span class="tok-p">(</span><span class="tok-n">extract-snippets</span> <span class="tok-n">from</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-n">include-file-snippets</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-n">generate-src-files</span> <span class="tok-n">to</span><span class="tok-p">))))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ultimate goal of generating source code is to produce files, so we only
need to include other snippets into file snippets.  include-file-snippets
does exactly that.  This function takes a hash of snippets as a result of the
call to extract-snippets and returns a hash of snippets with all file
snippets <a href="#section/include-snippets">included</a>.  Let&#8217;s combine the implement
of include-file-snippets and generate-src-files to make a complete set of
helpers for generate-src.</p>
</div>
<div class="listingblock">
<div class="title">code::generate-snippets-helpers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-c1">;; lang racket</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">include-file-snippets</span> <span class="tok-n">snippets</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">boxed</span> <span class="tok-p">(</span><span class="tok-nb">box</span> <span class="tok-n">snippets</span><span class="tok-p">)]</span>
        <span class="tok-p">[</span><span class="tok-n">file-snippets/names</span> <span class="tok-p">(</span><span class="tok-nb">hash-keys</span> <span class="tok-p">(</span><span class="tok-n">get-file-snippets</span> <span class="tok-n">snippets</span><span class="tok-p">))])</span>
    <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([</span><span class="tok-n">target-name</span> <span class="tok-n">file-snippets/names</span><span class="tok-p">])</span>
      <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">target</span> <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-n">snippets</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-n">target-name</span><span class="tok-p">)])</span>
        <span class="tok-p">(</span><span class="tok-n">include-snippet</span> <span class="tok-n">boxed</span> <span class="tok-n">target</span> <span class="tok-p">{})))</span>
    <span class="tok-p">(</span><span class="tok-nb">unbox</span> <span class="tok-n">boxed</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-src-files</span> <span class="tok-n">snippets</span> <span class="tok-n">to</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([(</span><span class="tok-n">name</span> <span class="tok-n">snippet</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-n">get-file-snippets</span> <span class="tok-n">snippets</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">path</span>    <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">to</span> <span class="tok-n">name</span><span class="tok-p">)]</span>
           <span class="tok-p">[</span><span class="tok-n">content</span> <span class="tok-p">(</span><span class="tok-n">get-snippet-content</span> <span class="tok-n">snippet</span><span class="tok-p">)])</span>
      <span class="tok-p">(</span><span class="tok-n">create-dir</span> <span class="tok-p">(</span><span class="tok-n">path-&gt;directory</span> <span class="tok-n">path</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-nb">~a</span> <span class="tok-s2">&quot;-&gt; Writing &quot;</span> <span class="tok-n">path</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">display-to-file</span> <span class="tok-n">content</span> <span class="tok-n">path</span> <span class="tok-kd">#:exists</span> <span class="tok-o">&#39;</span><span class="tok-ss">truncate/replace</span><span class="tok-p">))))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-file-snippets</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">%</span> <span class="tok-o">&#39;</span><span class="tok-ss">file</span> <span class="tok-kd">#:else</span> <span class="tok-p">{}))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-code-snippets</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">%</span> <span class="tok-o">&#39;</span><span class="tok-ss">code</span> <span class="tok-kd">#:else</span> <span class="tok-p">{}))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And of course, we need to define help string for generate-src:</p>
</div>
<div class="listingblock">
<div class="title">file::commands/generate-src.help.txt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="text"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code">ulqui generate-src [--from from] [--to to]

Generate source code from literate documents.

  --from   either path to a directory literate documents are stored, or path
           to one literate document; default: &quot;src&quot;
  --to     directory where source code are generated, default: &quot;generated-src&quot;

Examples

Generate source code from src/ to generated-src/
  ulqui generate-src

or explitcitly
  ulqui generate-src --from src/ --to generated-src/

Generate source code from ../literate-source/ to ../source/
  ulqui generate-src --from ../literate-source/ --to ../source/
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once all functions are ready, let&#8217;s put them together into a command to
generate source code.</p>
</div>
<div class="listingblock">
<div class="title">file::commands/generate-src.rkt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span class="tok-c1">;; include::license-header</span>

<span class="tok-c1">;; include::use-rackjure</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../command-core.rkt&quot;</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../utils/utils.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../utils/path.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../utils/string.rkt&quot;</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">provide</span> <span class="tok-n">run</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">rackunit</span><span class="tok-p">))</span>

<span class="tok-c1">;; include::generate-src</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run</span> <span class="tok-kd">#:from</span> <span class="tok-p">[</span><span class="tok-n">from</span> <span class="tok-s2">&quot;src&quot;</span><span class="tok-p">]</span>
             <span class="tok-kd">#:to</span>   <span class="tok-p">[</span><span class="tok-n">to</span>   <span class="tok-s2">&quot;generated-src&quot;</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-n">display-command</span> <span class="tok-s2">&quot;Generating source&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">generate-src</span> <span class="tok-kd">#:from</span> <span class="tok-n">from</span>
                <span class="tok-kd">#:to</span>   <span class="tok-n">to</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s how generate-src should be done.  It&#8217;s time to generalize this
structure for defining other commands as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anatomy_of_a_ulquikit_command">3. Anatomy of a Ulquikit command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ulquikit commands are actually a Racket modules, residing in commands/.  The
name of the module (without .rkt extension of course) is the actual command.
E.g. commands/generate-src.rkt implements generate-src command.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, each command has to provide at least 2 functions: run
and help:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command line arguments are parsed and passed through run function.  Named
arguments are automatically converted to either boolean or number and passed
as Racket keywords.</p>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ulqui generate-src calls commands/generate-src's (run).</p>
</li>
<li>
<p>ulqui generate-src some-file calls commands/generate-src's (run "some-file").</p>
</li>
<li>
<p>ulqui generate-src --from file1 --to file2 calls
commands/generate-src's (run #:from "file1" #:to "file2").</p>
</li>
</ul>
</div>
</li>
<li>
<p>When ulqui help command-name or ulqui command-name --help is invoked,
the help function that belongs to commands/command-name.rkt module is
called.  The same effect could be achieved by calling (run #:help #t).
This the help function takes no arguments and returns a string that would
be displayed as help.</p>
</li>
<li>
<p>Usually, in a typical program, help strings are hardcoded into the source
code, which makes the maintenance of help strings harder that necessary, not
to mention the code looks really ugly.  Ulquikit defines a convention for
writing and maintaining helps more effectively: command do-something has
its help stored in commands/do-something.help.txt.  See the implementation
of <a href="#command/generate-src">generate-src</a> for more details on
<a href="#help/generate-src">how help string</a> is stored.</p>
</li>
<li>
<p>All commands must import command-core.rkt (relative to command directory:
../command-core.rkt).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With all that has been said, let&#8217;s move on to the function which is used to
parse command line arguments.</p>
</div>
<div class="sect2">
<h3 id="_parsing_command_line_arguments_parse_command_args">3.1. Parsing command line arguments parse-command-args</h3>
<div class="paragraph">
<p>This function takes all arguments passed to the command line as a list of
string and returns a map of following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-n">list-of-arguments</span>  <i class="conum" data-value="1"></i><b>(1)</b>
 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-n">hash-of-options</span><span class="tok-p">}</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>main arguments collected as a list, with the same order as they are at the
command line</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>options are collected a hash; options that have no values are set to #t</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>[[func/parse-command-args]]
.code::parse-command-args</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</div></td><td class="code"><span class="tok-c1">;; include::parse-command-args-helpers</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-n">args</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">arguments</span> <span class="tok-p">(</span><span class="tok-nb">takef</span> <span class="tok-n">args</span> <span class="tok-n">is-argument?</span><span class="tok-p">)]</span>
        <span class="tok-p">[</span><span class="tok-n">rest-args</span> <span class="tok-p">(</span><span class="tok-nb">dropf</span> <span class="tok-n">args</span> <span class="tok-n">is-argument?</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-n">parse-options</span> <span class="tok-p">([</span><span class="tok-n">rest-args</span>  <span class="tok-n">rest-args</span><span class="tok-p">]</span>
                        <span class="tok-p">[</span><span class="tok-n">options</span>    <span class="tok-p">{}])</span>
      <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">empty?</span> <span class="tok-n">rest-args</span><span class="tok-p">)</span>
          <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-n">arguments</span>
           <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-n">options</span><span class="tok-p">}</span>
          <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">option-name</span>   <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-n">rest-args</span><span class="tok-p">)]</span>
                 <span class="tok-p">[</span><span class="tok-n">option-values</span> <span class="tok-p">(</span><span class="tok-nb">takef</span> <span class="tok-p">(</span><span class="tok-nb">drop</span> <span class="tok-n">rest-args</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-n">is-argument?</span><span class="tok-p">)]</span>
                 <span class="tok-p">[</span><span class="tok-n">rest-args</span>     <span class="tok-p">(</span><span class="tok-nb">dropf</span> <span class="tok-p">(</span><span class="tok-nb">rest</span> <span class="tok-n">rest-args</span><span class="tok-p">)</span>   <span class="tok-n">is-argument?</span><span class="tok-p">)]</span>

                 <span class="tok-p">[</span><span class="tok-n">option-values/converted</span> <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-n">try-convert-value</span> <span class="tok-n">option-values</span><span class="tok-p">)]</span>

                 <span class="tok-p">[</span><span class="tok-n">name</span>   <span class="tok-p">(</span><span class="tok-n">option-&gt;keyword</span> <span class="tok-n">option-name</span><span class="tok-p">)]</span>
                 <span class="tok-p">[</span><span class="tok-nb">values</span> <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-nb">zero?</span> <span class="tok-p">(</span><span class="tok-nb">length</span> <span class="tok-n">option-values/converted</span><span class="tok-p">))</span>
                                <span class="tok-no">#t</span><span class="tok-p">]</span>
                               <span class="tok-p">[(</span><span class="tok-nb">=</span> <span class="tok-p">(</span><span class="tok-nb">length</span> <span class="tok-n">option-values/converted</span><span class="tok-p">)</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
                                <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-n">option-values/converted</span><span class="tok-p">)]</span>
                               <span class="tok-p">[</span><span class="tok-k">else</span>
                                <span class="tok-n">option-values/converted</span><span class="tok-p">])])</span>
            <span class="tok-p">(</span><span class="tok-n">parse-options</span> <span class="tok-n">rest-args</span>
                           <span class="tok-p">(</span><span class="tok-n">options</span> <span class="tok-n">name</span> <span class="tok-nb">values</span><span class="tok-p">)))))))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">())</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">()</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello-world&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello-world&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;world&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;world&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;--help&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">()</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-kd">#:help</span> <span class="tok-no">#t</span><span class="tok-p">}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;--help&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-kd">#:help</span> <span class="tok-no">#t</span><span class="tok-p">}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;--help&quot;</span> <span class="tok-s2">&quot;world&quot;</span> <span class="tok-s2">&quot;args&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-kd">#:help</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;world&quot;</span> <span class="tok-s2">&quot;args&quot;</span><span class="tok-p">)}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;--help&quot;</span> <span class="tok-s2">&quot;hello&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">()</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-kd">#:help</span> <span class="tok-s2">&quot;hello&quot;</span><span class="tok-p">}})</span>

  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;world&quot;</span> <span class="tok-s2">&quot;--help&quot;</span> <span class="tok-s2">&quot;--set-tab&quot;</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">))</span>
                <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-ss">arguments</span> <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span> <span class="tok-s2">&quot;world&quot;</span><span class="tok-p">)</span>
                 <span class="tok-o">&#39;</span><span class="tok-ss">options</span>   <span class="tok-p">{</span><span class="tok-o">&#39;</span><span class="tok-kd">#:help</span> <span class="tok-no">#t</span>
                             <span class="tok-o">&#39;</span><span class="tok-kd">#:set-tab</span> <span class="tok-mi">4</span><span class="tok-p">}}))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As always, it&#8217;s a good style to implement some helpers for
<a href="#func/parse-command-args">parse-command-args</a>.</p>
</div>
<div class="listingblock">
<div class="title">code::parse-command-args-helpers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</div></td><td class="code"><span class="tok-c1">;; #lang racket</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">is-argument?</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-n">string-starts-with?</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;-&quot;</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>     <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-p">)</span>    <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-s2">&quot;-a&quot;</span><span class="tok-p">)</span>   <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-s2">&quot;--a&quot;</span><span class="tok-p">)</span>  <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-s2">&quot;-&quot;</span><span class="tok-p">)</span>    <span class="tok-no">#f</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">is-option?</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-n">is-argument?</span> <span class="tok-n">%</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-option?</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>     <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-option?</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-p">)</span>    <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-option?</span> <span class="tok-s2">&quot;-a&quot;</span><span class="tok-p">)</span>   <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-option?</span> <span class="tok-s2">&quot;--a&quot;</span><span class="tok-p">)</span>  <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">is-option?</span> <span class="tok-s2">&quot;-&quot;</span><span class="tok-p">)</span>    <span class="tok-no">#t</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">option-&gt;keyword</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">string-&gt;keyword</span> <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-nb">string-&gt;list</span> <span class="tok-n">%</span><span class="tok-p">)</span>
                       <span class="tok-p">(</span><span class="tok-nb">dropf</span> <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">(</span><span class="tok-n">ch</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-nb">eq?</span> <span class="tok-sc">#\-</span> <span class="tok-n">ch</span><span class="tok-p">)))</span>
                       <span class="tok-nb">list-&gt;string</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">option-&gt;keyword</span> <span class="tok-s2">&quot;-h&quot;</span><span class="tok-p">)</span>      <span class="tok-o">&#39;</span><span class="tok-kd">#:h</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">option-&gt;keyword</span> <span class="tok-s2">&quot;--help&quot;</span><span class="tok-p">)</span>  <span class="tok-o">&#39;</span><span class="tok-kd">#:help</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">option-&gt;keyword</span> <span class="tok-s2">&quot;---help&quot;</span><span class="tok-p">)</span> <span class="tok-o">&#39;</span><span class="tok-kd">#:help</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">try-convert-value</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">if-let</span> <span class="tok-p">[</span><span class="tok-n">value</span> <span class="tok-p">(</span><span class="tok-nb">string-&gt;number</span> <span class="tok-n">%</span><span class="tok-p">)]</span>
      <span class="tok-n">value</span>
      <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-nb">string=?</span> <span class="tok-s2">&quot;true&quot;</span> <span class="tok-n">%</span><span class="tok-p">)</span>
             <span class="tok-no">#t</span><span class="tok-p">]</span>
            <span class="tok-p">[(</span><span class="tok-nb">string=?</span> <span class="tok-s2">&quot;false&quot;</span> <span class="tok-n">%</span><span class="tok-p">)</span>
             <span class="tok-no">#f</span><span class="tok-p">]</span>
            <span class="tok-p">[</span><span class="tok-k">else</span>
             <span class="tok-n">%</span><span class="tok-p">])))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">try-convert-value</span> <span class="tok-s2">&quot;1&quot;</span><span class="tok-p">)</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">try-convert-value</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">try-convert-value</span> <span class="tok-s2">&quot;true&quot;</span><span class="tok-p">)</span>  <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">try-convert-value</span> <span class="tok-s2">&quot;false&quot;</span><span class="tok-p">)</span> <span class="tok-no">#f</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_corresponding_command">3.2. Calling corresponding command</h3>
<div class="paragraph">
<p>Function run-command does exactly that, i.e. it calls corresponding command
and passes necessary arguments.</p>
</div>
<div class="paragraph">
<p>[[func/run-command]]
.code::run-command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run-command</span> <span class="tok-n">command</span> <span class="tok-n">args</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">module-location</span> <span class="tok-p">(</span><span class="tok-nb">string-&gt;path</span>
                           <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">+ulquikit-location+</span>
                                     <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;commands/~a.rkt&quot;</span>
                                             <span class="tok-n">command</span><span class="tok-p">)))]</span>
         <span class="tok-p">[</span><span class="tok-n">run-func</span>        <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-n">module-location</span> <span class="tok-o">&#39;</span><span class="tok-ss">run</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">args</span>            <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">hash?</span> <span class="tok-n">args</span><span class="tok-p">)</span>
                              <span class="tok-n">args</span>
                              <span class="tok-p">(</span><span class="tok-n">parse-command-args</span> <span class="tok-n">args</span><span class="tok-p">))]</span>
         <span class="tok-p">[</span><span class="tok-n">main-args</span>       <span class="tok-p">(</span><span class="tok-n">args</span> <span class="tok-o">&#39;</span><span class="tok-ss">arguments</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">keyword-list</span>    <span class="tok-p">(</span><span class="tok-nb">hash-keys</span> <span class="tok-p">(</span><span class="tok-n">args</span> <span class="tok-o">&#39;</span><span class="tok-ss">options</span><span class="tok-p">))]</span>
         <span class="tok-p">[</span><span class="tok-n">val-list</span>        <span class="tok-p">(</span><span class="tok-nb">hash-values</span> <span class="tok-p">(</span><span class="tok-n">args</span> <span class="tok-o">&#39;</span><span class="tok-ss">options</span><span class="tok-p">))])</span>
    <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-n">args</span> <span class="tok-o">&#39;</span><span class="tok-ss">options</span> <span class="tok-o">&#39;</span><span class="tok-kd">#:help</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-n">run-help</span> <span class="tok-n">command</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-k">with-handlers</span> <span class="tok-p">([</span><span class="tok-nb">exn:fail:contract?</span>
                         <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">)</span>
                           <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Invalid option(s)&quot;</span><span class="tok-p">)</span>
                           <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-n">e</span><span class="tok-p">)</span>
                           <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>
                           <span class="tok-p">(</span><span class="tok-n">run-help</span> <span class="tok-n">command</span><span class="tok-p">))])</span>
          <span class="tok-p">(</span><span class="tok-nb">keyword-apply</span> <span class="tok-n">run-func</span>
                         <span class="tok-n">keyword-list</span>
                         <span class="tok-n">val-list</span>
                         <span class="tok-n">main-args</span><span class="tok-p">)))</span>
    <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides <a href="#func/run-command">run-command</a>, we also have run-help as a
helper to display help of a command.  run-help simply reads the help file of
the corresponding command and returns its content.</p>
</div>
<div class="listingblock">
<div class="title">code::run-help</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run-help</span> <span class="tok-n">command</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">help-file</span> <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">+ulquikit-location+</span>
                              <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;commands/~a.help.txt&quot;</span>
                                      <span class="tok-n">command</span><span class="tok-p">))])</span>
    <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">read-file</span> <span class="tok-n">help-file</span><span class="tok-p">))))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_all_command_things_together">3.3. Putting all command things together</h3>
<div class="paragraph">
<p>With all necessary functions implemented, module command-core which all
other commands have to required comes down to this little piece below:</p>
</div>
<div class="listingblock">
<div class="title">file::command-core.rkt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span class="tok-c1">;; include::license-header</span>

<span class="tok-c1">;; include::use-rackjure</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;ulquikit.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;utils/path.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;utils/string.rkt&quot;</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">provide</span> <span class="tok-n">run-command</span>
         <span class="tok-p">(</span><span class="tok-k">rename-out</span> <span class="tok-p">[</span><span class="tok-n">run-help</span> <span class="tok-n">run-command-help</span><span class="tok-p">]</span>
                     <span class="tok-p">[</span><span class="tok-n">run-help</span> <span class="tok-n">run-help</span><span class="tok-p">])</span>
         <span class="tok-n">display-command</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">rackunit</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">display-command</span> <span class="tok-n">title</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;==== &quot;</span> <span class="tok-n">title</span> <span class="tok-s2">&quot; ====&quot;</span><span class="tok-p">)))</span>

<span class="tok-c1">;; include::parse-command-args</span>

<span class="tok-c1">;; include::run-command</span>

<span class="tok-c1">;; include::run-help</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next big piece of Ulquikit is the generate-html command which generates
HTML documents with some default options.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_html">4. Generating HTML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, let&#8217;s decide upon how this command is used:</p>
</div>
<div class="listingblock">
<div class="title">file::commands/generate-html.help.txt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="text"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code">Usage: generate-html [--from from] [--to to]

Generate HTMLs from literate documents.

  --from   either path to a directory where literate documents are stored, or
           path to one literate document, default: &quot;src&quot;

  --to     directory where HTMLs are generated, default: &quot;generated-html&quot;

Examples

Generate HTMLs from src/ to generated-html/ recursively
  ulqui generate-html

or explicitly
  ulqui generate-html --from src/ --to generated-html/

Generate HTMLs from literate-source/ to generated-documents/
  ulqui generate-html \
    --from literate-source/ \
    --to generated-documents
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As in other commands, generate-html also has a main function, which is named
generate-html as well, taking 2 optional directories: source (of AsciiDoc
documents) and destination (where HTML documents are generated), namedly
#:from and #:to as in <a href="#func/generate-src">generate-src</a>.</p>
</div>
<div class="listingblock">
<div class="title">code::generate-html</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-html</span> <span class="tok-kd">#:from</span>      <span class="tok-p">[</span><span class="tok-n">from</span> <span class="tok-s2">&quot;src&quot;</span><span class="tok-p">]</span>
                       <span class="tok-kd">#:to</span>        <span class="tok-p">[</span><span class="tok-n">to</span> <span class="tok-s2">&quot;generated-html&quot;</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">from</span>  <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">from</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">to</span>    <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">to</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">docs</span>  <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">file-exists?</span> <span class="tok-n">from</span><span class="tok-p">)</span>
                    <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-k">file</span> <span class="tok-p">(</span><span class="tok-nb">list</span> <span class="tok-n">from</span><span class="tok-p">)])</span>
                      <span class="tok-p">(</span><span class="tok-k">set!</span> <span class="tok-n">from</span> <span class="tok-p">(</span><span class="tok-n">path-&gt;directory</span> <span class="tok-n">from</span><span class="tok-p">))</span>
                      <span class="tok-k">file</span><span class="tok-p">)</span>
                    <span class="tok-p">(</span><span class="tok-n">list-all-adocs</span> <span class="tok-n">from</span><span class="tok-p">))])</span>
    <span class="tok-p">(</span><span class="tok-k">parameterize</span> <span class="tok-p">([</span><span class="tok-nb">current-directory</span> <span class="tok-n">from</span><span class="tok-p">])</span>
      <span class="tok-p">(</span><span class="tok-k">for</span> <span class="tok-p">([</span><span class="tok-n">doc</span> <span class="tok-n">docs</span><span class="tok-p">])</span>
        <span class="tok-p">(</span><span class="tok-n">render-asciidoc</span> <span class="tok-n">doc</span>
                         <span class="tok-p">(</span><span class="tok-n">get-relative-path</span> <span class="tok-n">to</span> <span class="tok-p">(</span><span class="tok-n">get-output-file</span> <span class="tok-n">doc</span><span class="tok-p">)))))))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s dig into some helpers for this function.  The first helper to notice is
render-asciidoc, used to build and run rendering command with AsciiDoctor.</p>
</div>
<div class="paragraph">
<p>By default, AsciiDoctor is invoked with --doctype book.  Customization could
be added later.</p>
</div>
<div class="listingblock">
<div class="title">code::render-asciidoc</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">asciidoctor-format-command</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;asciidoctor ~a -d book -o ~a&quot;</span> <span class="tok-n">%1</span> <span class="tok-n">%2</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">render-asciidoc</span> <span class="tok-n">input-file</span> <span class="tok-n">output-file</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; &quot;</span> <span class="tok-n">input-file</span> <span class="tok-s2">&quot; =&gt; &quot;</span> <span class="tok-n">output-file</span><span class="tok-p">))</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-p">(</span><span class="tok-n">asciidoctor-format-command</span> <span class="tok-n">input-file</span> <span class="tok-n">output-file</span><span class="tok-p">)))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And last but not least, for generate-html to be ready, we need a function to
extract file name and replace .adoc extension with .html extension.</p>
</div>
<div class="listingblock">
<div class="title">code::get-output-file</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-output-file</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-nb">file-name-from-path</span> <span class="tok-n">%</span><span class="tok-p">)</span>
      <span class="tok-nb">path-&gt;string</span>
      <span class="tok-p">(</span><span class="tok-nb">string-replace</span> <span class="tok-s2">&quot;.adoc&quot;</span> <span class="tok-s2">&quot;.html&quot;</span><span class="tok-p">)))</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-output-file</span> <span class="tok-s2">&quot;/tmp/tmp.adoc&quot;</span><span class="tok-p">)</span>   <span class="tok-s2">&quot;tmp.html&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">check-equal?</span> <span class="tok-p">(</span><span class="tok-n">get-output-file</span> <span class="tok-s2">&quot;/tmp/world.adoc&quot;</span><span class="tok-p">)</span> <span class="tok-s2">&quot;world.html&quot;</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for command generate-html is as simple as followed:</p>
</div>
<div class="listingblock">
<div class="title">file::commands/generate-html.rkt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-c1">;; include::license-header</span>

<span class="tok-c1">;; include::use-rackjure</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../command-core.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../utils/path.rkt&quot;</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">provide</span> <span class="tok-n">run</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">test</span>
  <span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">rackunit</span><span class="tok-p">))</span>

<span class="tok-c1">;; include::render-asciidoc</span>

<span class="tok-c1">;; include::get-output-file</span>

<span class="tok-c1">;; include::generate-html</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run</span> <span class="tok-kd">#:from</span> <span class="tok-p">[</span><span class="tok-n">from</span> <span class="tok-s2">&quot;src&quot;</span><span class="tok-p">]</span>
             <span class="tok-kd">#:to</span>   <span class="tok-p">[</span><span class="tok-n">to</span>   <span class="tok-s2">&quot;generated-html&quot;</span><span class="tok-p">])</span>
  <span class="tok-p">(</span><span class="tok-n">display-command</span> <span class="tok-s2">&quot;Generating HTML&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">generate-html</span> <span class="tok-kd">#:from</span> <span class="tok-n">from</span>
                 <span class="tok-kd">#:to</span>   <span class="tok-n">to</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_ulqui_script">5. The ulqui script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have been going through all important internal components of
Ulquikit.  What&#8217;s left to make a complete, usable application is the main
command that takes care of user interactive: the ulqui script.  ulqui is a
complete Racket module.</p>
</div>
<div class="paragraph">
<p>First and foremost, this module should be able to detect all built-in commands
residing in commands/ directory.  This task is simple and straightforward:
find all .rkt files is commands/ directory and return them as a list
without their extensions.</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/list-commands</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">list-commands</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">command-dir</span> <span class="tok-p">(</span><span class="tok-n">get-path</span> <span class="tok-n">+ulqui-dir+</span> <span class="tok-s2">&quot;../commands/&quot;</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">commands</span>    <span class="tok-p">(</span><span class="tok-n">~&gt;&gt;</span> <span class="tok-p">(</span><span class="tok-nb">directory-list</span> <span class="tok-n">command-dir</span><span class="tok-p">)</span>
                        <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-nb">path-&gt;string</span><span class="tok-p">)</span>
                        <span class="tok-p">(</span><span class="tok-nb">filter</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-n">string-ends-with?</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;.rkt&quot;</span><span class="tok-p">))</span>
                        <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">regexp-replace</span> <span class="tok-sr">#px&quot;\\.rkt$&quot;</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)))])</span>
    <span class="tok-n">commands</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>ulqui might be liked, or copied indenpently, so the help of ulqui should
should be within in source.  Besides, whenever help is called, ulqui should
be able to detect all available commands and brief their helps.</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/display-help</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">display-help</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span>
   <span class="tok-n">@str</span><span class="tok-p">{</span><span class="tok-n">Usage:</span> <span class="tok-n">ulqui</span> <span class="tok-n">&lt;command&gt;</span> <span class="tok-p">[</span><span class="tok-n">options</span><span class="tok-p">]</span> <span class="tok-k">...</span>

<span class="tok-n">Ulquikit</span> <span class="tok-n">is</span> <span class="tok-n">yet</span> <span class="tok-n">another</span> <span class="tok-n">literate</span> <span class="tok-n">programming</span> <span class="tok-n">tool</span><span class="tok-o">,</span> <span class="tok-n">with</span> <span class="tok-n">the</span> <span class="tok-n">main</span> <span class="tok-n">tasks</span> <span class="tok-n">of</span>
<span class="tok-n">generating</span> <span class="tok-n">code</span> <span class="tok-k">and</span> <span class="tok-n">documentation</span> <span class="tok-n">from</span> <span class="tok-n">literate</span> <span class="tok-n">source.</span>

<span class="tok-n">Supported</span> <span class="tok-n">markup</span> <span class="tok-n">language:</span> <span class="tok-n">AsciiDoc.</span>
<span class="tok-n">Supported</span> <span class="tok-n">output</span> <span class="tok-n">formats</span> <span class="tok-k">for</span> <span class="tok-n">documentation:</span> <span class="tok-n">HTML.</span>

<span class="tok-n">Available</span> <span class="tok-n">commands:</span>

<span class="tok-p">})</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">commands</span>   <span class="tok-p">(</span><span class="tok-n">list-commands</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">full-helps</span> <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">with-output-to-string</span>
                              <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">()</span>
                                <span class="tok-p">(</span><span class="tok-n">run-help</span> <span class="tok-n">%</span><span class="tok-p">)))</span> <span class="tok-n">commands</span><span class="tok-p">)]</span>

         <span class="tok-p">[</span><span class="tok-n">helps</span>      <span class="tok-p">(</span><span class="tok-k">for/list</span> <span class="tok-p">([</span><span class="tok-n">text</span> <span class="tok-n">full-helps</span><span class="tok-p">])</span>
                       <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">lines</span> <span class="tok-p">(</span><span class="tok-nb">string-split</span> <span class="tok-n">text</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span> <span class="tok-kd">#:trim?</span> <span class="tok-no">#f</span><span class="tok-p">)]</span>
                              <span class="tok-p">[</span><span class="tok-n">usage-omitted</span> <span class="tok-p">(</span><span class="tok-nb">dropf</span> <span class="tok-n">lines</span>
                                                    <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-nb">string=?</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)))]</span>
                              <span class="tok-p">[</span><span class="tok-n">help</span> <span class="tok-p">(</span><span class="tok-nb">takef</span> <span class="tok-p">(</span><span class="tok-nb">rest</span> <span class="tok-n">usage-omitted</span><span class="tok-p">)</span>
                                           <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-nb">string=?</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)))])</span>
                         <span class="tok-p">(</span><span class="tok-nb">string-join</span> <span class="tok-n">help</span> <span class="tok-s2">&quot;</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">)))])</span>
    <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">(</span><span class="tok-n">command</span> <span class="tok-n">help</span><span class="tok-p">)</span>
           <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-p">(</span><span class="tok-nb">~a</span> <span class="tok-n">command</span>
                                       <span class="tok-kd">#:width</span> <span class="tok-mi">15</span><span class="tok-p">))</span>
                           <span class="tok-s2">&quot; :: &quot;</span>
                           <span class="tok-n">help</span><span class="tok-p">)))</span>
         <span class="tok-n">commands</span>
         <span class="tok-n">helps</span><span class="tok-p">))</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span>
   <span class="tok-n">@str</span><span class="tok-p">{</span>
<span class="tok-n">Use</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui</span> <span class="tok-n">help</span><span class="tok-o">&#39;</span> <span class="tok-ss">or</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui</span> <span class="tok-n">--help</span><span class="tok-o">&#39;</span> <span class="tok-ss">to</span> <span class="tok-n">bring</span> <span class="tok-n">up</span> <span class="tok-k">this</span> <span class="tok-n">help.</span>
<span class="tok-n">Use</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui</span> <span class="tok-n">help</span> <span class="tok-n">&lt;command&gt;</span><span class="tok-o">&#39;</span> <span class="tok-ss">or</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui</span> <span class="tok-n">&lt;command&gt;</span> <span class="tok-n">--help</span><span class="tok-o">&#39;</span> <span class="tok-ss">to</span> <span class="tok-n">get</span> <span class="tok-n">help</span> <span class="tok-k">for</span> <span class="tok-n">a</span>
<span class="tok-n">command.</span>
<span class="tok-n">Use</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui</span> <span class="tok-n">--version</span><span class="tok-o">&#39;</span> <span class="tok-ss">to</span> <span class="tok-nb">display</span> <span class="tok-n">current</span> <span class="tok-n">running</span> <span class="tok-nb">version</span> <span class="tok-n">of</span> <span class="tok-n">Ulquikit.</span><span class="tok-p">})</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>One important thing to note is that ulqui script might be linked to and run
from different places.  Once it has been linked, Ulquikit directory is not the
directory that contains this script anymore, thus it needs to be re-calculated
and all functions which are imported need to be required manually:</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/require-utils</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">+ulqui-script-path+</span>
  <span class="tok-p">(</span><span class="tok-nb">simplify-path</span> <span class="tok-p">(</span><span class="tok-nb">build-path</span> <span class="tok-p">(</span><span class="tok-nb">find-system-path</span> <span class="tok-o">&#39;</span><span class="tok-ss">orig-dir</span><span class="tok-p">)</span>
                             <span class="tok-p">(</span><span class="tok-nb">find-system-path</span> <span class="tok-o">&#39;</span><span class="tok-ss">run-file</span><span class="tok-p">))))</span>


<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">+ulqui-dir+</span>
  <span class="tok-p">(</span><span class="tok-k">let-values</span> <span class="tok-p">([(</span><span class="tok-n">base</span> <span class="tok-n">name</span> <span class="tok-n">must-be-dir?</span><span class="tok-p">)</span>
                <span class="tok-p">(</span><span class="tok-nb">split-path</span> <span class="tok-n">+ulqui-script-path+</span><span class="tok-p">)])</span>
    <span class="tok-n">base</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-ulqui-module-path</span>
  <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">build-path</span> <span class="tok-n">+ulqui-dir+</span> <span class="tok-n">%</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">+ulquikit-version+</span>
 <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-p">(</span><span class="tok-n">get-ulqui-module-path</span> <span class="tok-s2">&quot;../ulquikit.rkt&quot;</span><span class="tok-p">)</span>
                  <span class="tok-o">&#39;</span><span class="tok-ss">+ulquikit-version+</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">string-ends-with?</span>
 <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-p">(</span><span class="tok-n">get-ulqui-module-path</span> <span class="tok-s2">&quot;../utils/string.rkt&quot;</span><span class="tok-p">)</span>
                  <span class="tok-o">&#39;</span><span class="tok-ss">string-ends-with?</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">get-path</span>
  <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-p">(</span><span class="tok-n">get-ulqui-module-path</span> <span class="tok-s2">&quot;../utils/path.rkt&quot;</span><span class="tok-p">)</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">get-path</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">run-help</span>
  <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-p">(</span><span class="tok-n">get-ulqui-module-path</span> <span class="tok-s2">&quot;../command-core.rkt&quot;</span><span class="tok-p">)</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">run-help</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">run-command</span>
 <span class="tok-p">(</span><span class="tok-nb">dynamic-require</span> <span class="tok-p">(</span><span class="tok-n">get-ulqui-module-path</span> <span class="tok-s2">&quot;../command-core.rkt&quot;</span><span class="tok-p">)</span>
                  <span class="tok-o">&#39;</span><span class="tok-ss">run-command</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Putting all things mentioned above together, we have the following ulqui
script.  To make the script as practical as possible, certain things should be
clarified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, running ulqui alone usually means users need some help.  Thus
running ulqui is equivalent to running ulqui help.</p>
</li>
<li>
<p>If users execute invalid command, this script also fallbacks to ulqui
help with a small error message.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">file::bin/ulqui</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</div></td><td class="code"><span class="tok-c">#!/usr/bin/env racket</span>

<span class="tok-c1">;; include::license-header</span>

<span class="tok-kn">#lang </span><span class="tok-nn">at-exp</span> <span class="tok-n">rackjure</span>

<span class="tok-p">(</span><span class="tok-n">current-curly-dict</span> <span class="tok-nb">hash</span><span class="tok-p">)</span>

<span class="tok-c1">;; include::ulqui/display-version</span>

<span class="tok-c1">;; include::ulqui/require-utils</span>

<span class="tok-c1">;; include::ulqui/list-commands</span>

<span class="tok-c1">;; include::ulqui/display-help</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">main</span>
  <span class="tok-p">(</span><span class="tok-nb">void</span>
   <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">command-list</span> <span class="tok-p">(</span><span class="tok-n">list-commands</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">arguments</span> <span class="tok-p">(</span><span class="tok-nb">vector-&gt;list</span> <span class="tok-p">(</span><span class="tok-nb">current-command-line-arguments</span><span class="tok-p">))]</span>
          <span class="tok-p">[</span><span class="tok-n">arg-list</span>  <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">empty?</span> <span class="tok-n">arguments</span><span class="tok-p">)</span>
                         <span class="tok-o">&#39;</span><span class="tok-p">(</span><span class="tok-s2">&quot;help&quot;</span><span class="tok-p">)</span>
                         <span class="tok-n">arguments</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">command</span>   <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-n">arg-list</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">args</span>      <span class="tok-p">(</span><span class="tok-nb">rest</span> <span class="tok-n">arg-list</span><span class="tok-p">)])</span>
     <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-nb">string=?</span> <span class="tok-s2">&quot;help&quot;</span> <span class="tok-n">command</span><span class="tok-p">)</span>
            <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">empty?</span> <span class="tok-n">args</span><span class="tok-p">)</span>
                <span class="tok-p">(</span><span class="tok-n">display-help</span><span class="tok-p">)</span>
                <span class="tok-p">(</span><span class="tok-n">run-help</span> <span class="tok-p">(</span><span class="tok-nb">first</span> <span class="tok-n">args</span><span class="tok-p">)))]</span>
           <span class="tok-p">[(</span><span class="tok-nb">string=?</span> <span class="tok-s2">&quot;--version&quot;</span> <span class="tok-n">command</span><span class="tok-p">)</span>
            <span class="tok-p">(</span><span class="tok-n">display-version</span><span class="tok-p">)]</span>
           <span class="tok-p">[(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-nb">member</span> <span class="tok-n">command</span> <span class="tok-n">command-list</span><span class="tok-p">))</span>
            <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; Invalid command &quot;</span> <span class="tok-n">command</span> <span class="tok-s2">&quot;.</span><span class="tok-se">\n</span><span class="tok-s2">&quot;</span><span class="tok-p">))</span>
            <span class="tok-p">(</span><span class="tok-n">display-help</span><span class="tok-p">)]</span>
           <span class="tok-p">[</span><span class="tok-k">else</span>
            <span class="tok-p">(</span><span class="tok-n">run-command</span> <span class="tok-n">command</span> <span class="tok-n">args</span><span class="tok-p">)]))))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Oh, and let&#8217;s not forget this small but useful function: display-version</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/display-version</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">display-version</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;Ulquikit v&quot;</span> <span class="tok-n">+ulquikit-version+</span><span class="tok-p">)))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_ulquikit_source_code">6. Managing Ulquikit source code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As Ulquikit grows, the need for a script/tool to manage source code,
release, &#8230;&#8203; arises.  This schiffer script (named after last name of
<a href="http://en.wikipedia.org/wiki/List_of_Hollows_in_Bleach#Ulquiorra_Schiffer">Ulquiorra
Schiffer</a>) is born to fulfilled that need.</p>
</div>
<div class="sect2">
<h3 id="_generate_source_code_and_html_documents_all_at_once">6.1. Generate source code and HTML documents, all at once</h3>
<div class="paragraph">
<p>This function simply makes a call to <a href="#command/generate-src">generate-src</a>
and <a href="#command/generate-html">generate-html</a> commands.  Note that the
schiffer script only has its use inside Ulquikit project, so when it&#8217;s
generated, it&#8217;s moved outside generated-src.  Also, all files in
generated-src/bin/ directory should be given executable permission.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/generate-all</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-src</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-s2">&quot;ulqui generate-src&quot;</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Giving executable permission to generated-src/bin/*&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-s2">&quot;chmod +x generated-src/bin/*&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Moving schiffer to current directory&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">rename-file-or-directory</span> <span class="tok-s2">&quot;generated-src/bin/schiffer&quot;</span>
                            <span class="tok-s2">&quot;schiffer-dev&quot;</span>
                            <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;   generated-src/bin/schiffer =&gt; ./schiffer-dev&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Moving quick installation script to current directory&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">rename-file-or-directory</span> <span class="tok-s2">&quot;generated-src/bin/quick-install.sh&quot;</span>
                            <span class="tok-s2">&quot;quick-install.sh&quot;</span>
                            <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;   generated-src/bin/quick-install.sh =&gt; ./quick-install.sh&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-html</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-s2">&quot;ulqui generate-html&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">generate-all</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">generate-src</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">generate-html</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_self">6.2. Update-self</h3>
<div class="paragraph">
<p>This function simply copy and replace schiffer script with schiffer-dev
without re-generating source code.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/update-self</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">update-self</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Replacing schiffer with schiffer-dev&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">copy-file</span> <span class="tok-s2">&quot;schiffer-dev&quot;</span> <span class="tok-s2">&quot;schiffer&quot;</span> <span class="tok-no">#t</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;   ./schiffer-dev -&gt; ./schiffer&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mark_current_source_as_stable">6.3. Mark current source as stable</h3>
<div class="paragraph">
<p>Marking current generated source code as stable by replacing
release/ulquikit with generated-src.  Note that this function/command does
<strong>not</strong> re-generate source code.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/mark-stable</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">mark-stable</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Removing current stable&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">delete-directory/files</span> <span class="tok-s2">&quot;release&quot;</span> <span class="tok-kd">#:must-exist?</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Creating stable directory: release&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">make-directory*</span> <span class="tok-s2">&quot;release&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Copying current generated source to stable&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;   generated-src -&gt; release/ulquikit&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">copy-directory/files</span> <span class="tok-s2">&quot;generated-src&quot;</span> <span class="tok-s2">&quot;release/ulquikit&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Copying docs&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;   generated-html -&gt; release/ulquikit/docs&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">copy-directory/files</span> <span class="tok-s2">&quot;generated-html&quot;</span> <span class="tok-s2">&quot;release/ulquikit/docs&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_release">6.4. Release</h3>
<div class="paragraph">
<p>[[schiffer/mark-release]]
.code::schiffer/mark-release</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">mark-release</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">mark-stable</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">latest-tag</span>       <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-nb">process</span> <span class="tok-s2">&quot;git tag&quot;</span><span class="tok-p">)</span>
                             <span class="tok-nb">first</span>
                             <span class="tok-nb">port-&gt;string</span>
                             <span class="tok-nb">string-split</span>
                             <span class="tok-nb">last</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">filename</span>         <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;ulquikit-~a.zip&quot;</span> <span class="tok-n">latest-tag</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">zip-command</span>      <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;zip -r ~a ulquikit&quot;</span> <span class="tok-n">filename</span><span class="tok-p">)]</span>
         <span class="tok-p">[</span><span class="tok-n">checksum-command</span> <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;md5sum ~a &gt; ~a.md5&quot;</span>
                                   <span class="tok-n">filename</span>
                                   <span class="tok-n">filename</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-k">parameterize</span> <span class="tok-p">[(</span><span class="tok-nb">current-directory</span> <span class="tok-s2">&quot;release&quot;</span><span class="tok-p">)]</span>
      <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;=&gt; Creating release/&quot;</span> <span class="tok-n">filename</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-n">zip-command</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>

      <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;=&gt; Creating checksum for release/&quot;</span> <span class="tok-n">filename</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-n">checksum-command</span><span class="tok-p">)</span>
      <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;   release/&quot;</span> <span class="tok-n">filename</span> <span class="tok-s2">&quot; =&gt; release/&quot;</span> <span class="tok-n">filename</span> <span class="tok-s2">&quot;.md5&quot;</span><span class="tok-p">))</span>
      <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_current_dev_version_of_ulquikit">6.5. Run current dev version of Ulquikit</h3>
<div class="paragraph">
<p>Running current Ulquikit dev version is done by calling
generated-src/bin/ulqui.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/ulqui-dev</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">ulqui-dev</span> <span class="tok-n">args</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;generated-src/bin/ulqui &quot;</span>
               <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-nb">map</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">string-append</span> <span class="tok-s2">&quot;&#39;&quot;</span> <span class="tok-n">%</span> <span class="tok-s2">&quot;&#39;&quot;</span><span class="tok-p">)</span> <span class="tok-n">args</span><span class="tok-p">)</span>
                 <span class="tok-p">(</span><span class="tok-nb">string-join</span> <span class="tok-s2">&quot; &quot;</span><span class="tok-p">))))</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_tests">6.6. Run tests</h3>
<div class="paragraph">
<p>By calling raco test generated-src/*.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/run-tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run-tests</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-s2">&quot;raco test generated-src/*&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clean_up">6.7. Clean up</h3>
<div class="paragraph">
<p>Simply removing generated-html and generated-src directories:</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/clean-up</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">clean-up</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Removing generated-html&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">delete-directory/files</span> <span class="tok-s2">&quot;generated-html&quot;</span> <span class="tok-kd">#:must-exist?</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-s2">&quot;=&gt; Removing generated-src&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">delete-directory/files</span> <span class="tok-s2">&quot;generated-src&quot;</span> <span class="tok-kd">#:must-exist?</span> <span class="tok-no">#f</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_help">6.8. Help</h3>
<div class="paragraph">
<p>Of course, help is particularly useful.</p>
</div>
<div class="listingblock">
<div class="title">code::schiffer/help</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">help</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-n">@str</span><span class="tok-p">{</span>
<span class="tok-n">Usage:</span> <span class="tok-n">schiffer</span> <span class="tok-n">&lt;command&gt;</span> <span class="tok-p">[</span><span class="tok-n">options</span><span class="tok-p">]</span> <span class="tok-k">...</span>

<span class="tok-n">Schiffer</span> <span class="tok-n">is</span> <span class="tok-n">a</span> <span class="tok-n">simple</span> <span class="tok-n">build</span> <span class="tok-n">script</span> <span class="tok-k">for</span> <span class="tok-n">Ulquikit.</span>

<span class="tok-n">Available</span> <span class="tok-n">commands:</span>

  <span class="tok-n">generate-src</span>  <span class="tok-n">::</span> <span class="tok-n">Generate</span> <span class="tok-n">Ulquikit</span> <span class="tok-n">source</span> <span class="tok-n">code</span> <span class="tok-n">to</span> <span class="tok-o">&#39;</span><span class="tok-ss">generated-src</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">generate-html</span> <span class="tok-n">::</span> <span class="tok-n">Generate</span> <span class="tok-n">Ulquikit</span> <span class="tok-n">HTML</span> <span class="tok-n">docs</span> <span class="tok-n">to</span> <span class="tok-o">&#39;</span><span class="tok-ss">generated-html</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">generate-all</span>  <span class="tok-n">::</span> <span class="tok-n">Call</span> <span class="tok-o">&#39;</span><span class="tok-ss">generate-src</span><span class="tok-o">&#39;,</span> <span class="tok-ss">then</span> <span class="tok-o">&#39;</span><span class="tok-ss">generate-html</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">update-self</span>   <span class="tok-n">::</span> <span class="tok-n">Update</span> <span class="tok-n">Schiffer</span><span class="tok-o">,</span> <span class="tok-n">replace</span> <span class="tok-n">itself</span> <span class="tok-n">with</span> <span class="tok-o">&#39;</span><span class="tok-ss">./schiffer-dev</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">mark-stable</span>   <span class="tok-n">::</span> <span class="tok-n">Mark</span> <span class="tok-n">current</span> <span class="tok-o">&#39;</span><span class="tok-ss">generated-src</span><span class="tok-o">&#39;</span> <span class="tok-ss">as</span> <span class="tok-n">stable</span> <span class="tok-n">by</span> <span class="tok-n">copying</span> <span class="tok-n">it</span> <span class="tok-n">into</span>
                   <span class="tok-o">&#39;</span><span class="tok-ss">release/ulquikit</span><span class="tok-o">&#39;</span>
  <span class="tok-ss">mark-release</span>  <span class="tok-n">::</span> <span class="tok-n">Mark</span> <span class="tok-n">current</span> <span class="tok-n">stable</span> <span class="tok-n">in</span> <span class="tok-o">&#39;</span><span class="tok-ss">release/ulquikit</span><span class="tok-o">&#39;</span> <span class="tok-ss">as</span> <span class="tok-n">release</span> <span class="tok-n">by</span>
                   <span class="tok-n">zipping</span> <span class="tok-n">it</span> <span class="tok-n">with</span> <span class="tok-n">latest</span> <span class="tok-n">Git</span> <span class="tok-k">tag</span> <span class="tok-n">name.</span>  <span class="tok-n">E.g.</span>
                  <span class="tok-o">&#39;</span><span class="tok-ss">release/ulquikit</span><span class="tok-o">&#39;</span> <span class="tok-ss">is</span> <span class="tok-n">zipped</span> <span class="tok-n">into</span> <span class="tok-o">&#39;</span><span class="tok-ss">release/ulquikit-v2.0.zip</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">ulqui-dev</span>     <span class="tok-n">::</span> <span class="tok-n">Analogous</span> <span class="tok-n">to</span> <span class="tok-o">&#39;</span><span class="tok-ss">generated-src/bin/ulqui</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">clean-up</span>      <span class="tok-n">::</span> <span class="tok-n">Clean</span> <span class="tok-n">up</span> <span class="tok-n">generated</span> <span class="tok-n">source</span> <span class="tok-k">and</span> <span class="tok-n">HTML.</span>
  <span class="tok-n">run-tests</span>     <span class="tok-n">::</span> <span class="tok-n">Run</span> <span class="tok-n">all</span> <span class="tok-n">Ulquikit</span> <span class="tok-n">tests</span> <span class="tok-n">in</span> <span class="tok-o">&#39;</span><span class="tok-ss">generated-src/</span><span class="tok-o">&#39;.</span>
  <span class="tok-ss">help</span>          <span class="tok-n">::</span> <span class="tok-n">Print</span> <span class="tok-k">this</span> <span class="tok-n">help.</span>

<span class="tok-n">Note</span> <span class="tok-n">that</span> <span class="tok-k">only</span> <span class="tok-o">&#39;</span><span class="tok-ss">ulqui-dev</span><span class="tok-o">&#39;</span> <span class="tok-ss">takes</span> <span class="tok-n">options.</span>
<span class="tok-p">})</span>
  <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_combine_into_schiffer">6.9. Combine into schiffer</h3>
<div class="listingblock">
<div class="title">file::bin/schiffer</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</div></td><td class="code"><span class="tok-c">#!/usr/bin/env racket</span>

<span class="tok-c1">;; include::license-header</span>

<span class="tok-kn">#lang </span><span class="tok-nn">at-exp</span> <span class="tok-n">rackjure</span>

<span class="tok-p">(</span><span class="tok-n">current-curly-dict</span> <span class="tok-nb">hash</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">net/url</span><span class="tok-p">)</span>

<span class="tok-c1">;; include::schiffer/generate-all</span>

<span class="tok-c1">;; include::schiffer/update-self</span>

<span class="tok-c1">;; include::schiffer/mark-stable</span>

<span class="tok-c1">;; include::schiffer/mark-release</span>

<span class="tok-c1">;; include::schiffer/ulqui-dev</span>

<span class="tok-c1">;; include::schiffer/clean-up</span>

<span class="tok-c1">;; include::schiffer/run-tests</span>

<span class="tok-c1">;; include::schiffer/help</span>

<span class="tok-p">(</span><span class="tok-k">module+</span> <span class="tok-n">main</span>
  <span class="tok-p">(</span><span class="tok-nb">void</span>
   <span class="tok-p">(</span><span class="tok-k">let*</span> <span class="tok-p">([</span><span class="tok-n">args</span>    <span class="tok-p">(</span><span class="tok-nb">current-command-line-arguments</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">command</span> <span class="tok-p">(</span><span class="tok-nb">vector-ref</span> <span class="tok-p">(</span><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">zero?</span> <span class="tok-p">(</span><span class="tok-nb">vector-length</span> <span class="tok-n">args</span><span class="tok-p">))</span>
                                   <span class="tok-o">#</span><span class="tok-p">(</span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span>
                                   <span class="tok-n">args</span><span class="tok-p">)</span>
                               <span class="tok-mi">0</span><span class="tok-p">)])</span>
     <span class="tok-p">(</span><span class="tok-k">match</span> <span class="tok-n">command</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;generate-src&quot;</span>     <span class="tok-p">(</span><span class="tok-n">generate-src</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;generate-html&quot;</span>    <span class="tok-p">(</span><span class="tok-n">generate-html</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;clean&quot;</span>            <span class="tok-p">(</span><span class="tok-n">clean-up</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;update-self&quot;</span>      <span class="tok-p">(</span><span class="tok-n">update-self</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;mark-stable&quot;</span>      <span class="tok-p">(</span><span class="tok-n">mark-stable</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-s2">&quot;mark-release&quot;</span>     <span class="tok-p">(</span><span class="tok-n">mark-release</span><span class="tok-p">)]</span>
       <span class="tok-p">[(</span><span class="tok-k">or</span> <span class="tok-s2">&quot;ulqui-dev&quot;</span>
            <span class="tok-s2">&quot;run-dev&quot;</span><span class="tok-p">)</span>     <span class="tok-p">(</span><span class="tok-n">ulqui-dev</span> <span class="tok-p">(</span><span class="tok-nb">vector-&gt;list</span> <span class="tok-p">(</span><span class="tok-nb">vector-drop</span> <span class="tok-n">args</span> <span class="tok-mi">1</span><span class="tok-p">)))]</span>
       <span class="tok-p">[(</span><span class="tok-k">or</span> <span class="tok-s2">&quot;test&quot;</span>
            <span class="tok-s2">&quot;run-tests&quot;</span><span class="tok-p">)</span>   <span class="tok-p">(</span><span class="tok-n">run-tests</span><span class="tok-p">)]</span>
       <span class="tok-p">[(</span><span class="tok-k">or</span> <span class="tok-s2">&quot;generate-all&quot;</span>
            <span class="tok-s2">&quot;build&quot;</span><span class="tok-p">)</span>       <span class="tok-p">(</span><span class="tok-n">generate-all</span><span class="tok-p">)]</span>
       <span class="tok-p">[</span><span class="tok-k">_</span>                  <span class="tok-p">(</span><span class="tok-n">help</span><span class="tok-p">)]))))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_ulquikit">7. Updating Ulquikit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As more versions of Ulquikit are released, having a way to update Ulquikit
from the command line is very helpful.  One way to do this is by adding
update command, so that users could update Ulquikit to latest version just
by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ulqui update</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_latest_version">7.1. Retrieve latest version</h3>
<div class="paragraph">
<p>Ulquikit is officially released via
<a href="https://help.github.com/articles/about-releases">Github Releases</a>, which
provides this URL <a href="https://github.com/cmpitg/ulquikit/releases/latest" class="bare">https://github.com/cmpitg/ulquikit/releases/latest</a> pointing
to latest release.</p>
</div>
<div class="paragraph">
<p>First of all, let&#8217;s curl this URL to see how it&#8217;s redirected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code">curl --head https://github.com/cmpitg/ulquikit/releases/latest

<span class="tok-c"># HTTP/1.1 302 Found</span>
<span class="tok-c"># Server: GitHub.com</span>
<span class="tok-o">[</span>snip<span class="tok-o">]</span>
<span class="tok-c"># Location: https://github.com/cmpitg/ulquikit/releases/tag/v0.2</span>
<span class="tok-o">[</span>snip<span class="tok-o">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>So that&#8217;s how it works, simple and straightforward.  The job now is to get the
"Location" attribute from HTTP header and grab the version.  With Racket&#8217;s
<a href="http://docs.racket-lang.org/net/url.html">net/url</a> library, it becomes trivial:</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/latest-version</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-n">+latest-release-url+</span>
  <span class="tok-p">(</span><span class="tok-n">string-&gt;url</span> <span class="tok-s2">&quot;https://github.com/cmpitg/ulquikit/releases/latest&quot;</span><span class="tok-p">))</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">get-latest-version</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">~&gt;</span> <span class="tok-p">(</span><span class="tok-n">call/input-url</span> <span class="tok-n">+latest-release-url+</span>
                      <span class="tok-n">head-impure-port</span>
                      <span class="tok-nb">port-&gt;string</span><span class="tok-p">)</span>
    <span class="tok-nb">string-split</span>
    <span class="tok-p">(</span><span class="tok-nb">dropf</span> <span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">not</span> <span class="tok-p">(</span><span class="tok-nb">string=?</span> <span class="tok-s2">&quot;Location:&quot;</span> <span class="tok-n">%</span><span class="tok-p">)))</span>
    <span class="tok-nb">second</span>
    <span class="tok-p">(</span><span class="tok-n">#λ</span><span class="tok-p">(</span><span class="tok-nb">regexp-match</span> <span class="tok-sr">#rx&quot;v(.*)&quot;</span> <span class="tok-n">%</span><span class="tok-p">))</span>
    <span class="tok-nb">second</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we use
<a href="http://docs.racket-lang.org/net/url.html#%28def" class="bare">http://docs.racket-lang.org/net/url.html#%28def</a>.<em>%28%28lib._net%2Furl..rkt%29._head-impure-port%29%29[head-impure-port]
instead of
<a href="http://docs.racket-lang.org/net/url.html#%28def" class="bare">http://docs.racket-lang.org/net/url.html#%28def</a>.</em>%28%28lib._net%2Furl..rkt%29._head-pure-port%29%29[head-pure-port]
as the response might content body.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_and_replace_ulquikit">7.2. Download and replace Ulquikit</h3>
<div class="sect3">
<h4 id="_construct_download_url">7.2.1. Construct download URL</h4>
<div class="paragraph">
<p>Let&#8217;s have a closer look: Version 2.0 has
<a href="https://github.com/cmpitg/ulquikit/releases/download/v0.2/ulquikit-v0.2.zip" class="bare">https://github.com/cmpitg/ulquikit/releases/download/v0.2/ulquikit-v0.2.zip</a> as
its download URL.  The filename ulquikit-v0.2.zip certainly depends on
naming convention, which <a href="#schiffer/mark-release">schiffer</a> has got us
covered.  So all download URLs follow the following format:
https://github.com/cmpitg/ulquikit/releases/download/v{latest-version}/ulquikit-v{latest-version}.zip.
Based on that, we have this function to construct download URL of the latest
version:</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/construct-download-url</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">construct-download-url</span> <span class="tok-p">[</span><span class="tok-nb">version</span> <span class="tok-p">(</span><span class="tok-n">get-latest-version</span><span class="tok-p">)])</span>
  <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;https://github.com/cmpitg/ulquikit/releases/download/v~a/ulquikit-v~a.zip&quot;</span>
          <span class="tok-nb">version</span>
          <span class="tok-nb">version</span><span class="tok-p">))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_download_and_unzip">7.2.2. Download and unzip</h4>
<div class="paragraph">
<p>There are a couple of ways to download and unzip the release file, among which
the following 2 are the most commonly used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using Racket&#8217;s own API - bad in performance and memory space.</p>
</li>
<li>
<p>Calling shell commands - platform-dependant but much better in performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s make this work first then improve later.  I&#8217;m going to choose the 2<sup>nd</sup>
option for now.</p>
</div>
<div class="paragraph">
<p>Note that system is used to call external commands, which in turn produce
some data to standard output and standard error.  Thus we make standard output
and standard error unbeffered during to system call to achieve the best
result.</p>
</div>
<div class="listingblock">
<div class="title">code::ulqui/download-and-unzip</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">download-and-unzip</span> <span class="tok-nb">version</span> <span class="tok-n">to-dir</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-k">parameterize</span> <span class="tok-p">([</span><span class="tok-nb">current-directory</span> <span class="tok-n">to-dir</span><span class="tok-p">])</span>
    <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">url</span>              <span class="tok-p">(</span><span class="tok-n">construct-download-url</span> <span class="tok-nb">version</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">filename</span>         <span class="tok-p">(</span><span class="tok-nb">format</span> <span class="tok-s2">&quot;ulquikit-v~a.zip&quot;</span> <span class="tok-nb">version</span><span class="tok-p">)]</span>
          <span class="tok-p">[</span><span class="tok-n">out-buffer-mode</span>  <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-output-port</span><span class="tok-p">))]</span>
          <span class="tok-p">[</span><span class="tok-n">err-buffer-mode</span>  <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-error-port</span><span class="tok-p">))])</span>

      <span class="tok-p">(</span><span class="tok-k">with-handlers</span> <span class="tok-p">([</span><span class="tok-nb">exn:fail?</span>
                       <span class="tok-p">(</span><span class="tok-k">λ</span> <span class="tok-p">(</span><span class="tok-k">_</span><span class="tok-p">)</span>
                         <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-output-port</span><span class="tok-p">)</span>
                                                  <span class="tok-n">out-buffer-mode</span><span class="tok-p">)</span>
                         <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-error-port</span><span class="tok-p">)</span>
                                                  <span class="tok-n">err-buffer-mode</span><span class="tok-p">))])</span>
        <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-output-port</span><span class="tok-p">)</span> <span class="tok-o">&#39;</span><span class="tok-ss">none</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-error-port</span><span class="tok-p">)</span> <span class="tok-o">&#39;</span><span class="tok-ss">none</span><span class="tok-p">)</span>

        <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; Downloading from &quot;</span> <span class="tok-n">url</span><span class="tok-p">))</span>
        <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;curl -O &quot;</span> <span class="tok-n">url</span><span class="tok-p">))</span>

        <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; Unzipping &quot;</span> <span class="tok-n">filename</span> <span class="tok-s2">&quot;, replacing old version with new version&quot;</span><span class="tok-p">))</span>
        <span class="tok-p">(</span><span class="tok-nb">system</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;unzip -o &quot;</span> <span class="tok-n">filename</span><span class="tok-p">))</span>

        <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; Removing &quot;</span> <span class="tok-n">filename</span><span class="tok-p">))</span>
        <span class="tok-p">(</span><span class="tok-nb">delete-directory/files</span> <span class="tok-n">filename</span><span class="tok-p">)</span>

        <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-output-port</span><span class="tok-p">)</span> <span class="tok-n">out-buffer-mode</span><span class="tok-p">)</span>
        <span class="tok-p">(</span><span class="tok-nb">file-stream-buffer-mode</span> <span class="tok-p">(</span><span class="tok-nb">current-error-port</span><span class="tok-p">)</span> <span class="tok-n">err-buffer-mode</span><span class="tok-p">)))))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_update_command">7.3. The update command</h3>
<div class="listingblock">
<div class="title">file::commands/update.rkt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span class="tok-c1">;; include::license-header</span>

<span class="tok-c1">;; include::use-rackjure</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">net/url</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../ulquikit.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../command-core.rkt&quot;</span><span class="tok-p">)</span>
<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-s2">&quot;../utils/path.rkt&quot;</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">provide</span> <span class="tok-n">run</span><span class="tok-p">)</span>

<span class="tok-c1">;; include::ulqui/latest-version</span>

<span class="tok-c1">;; include::ulqui/construct-download-url</span>

<span class="tok-c1">;; include::ulqui/download-and-unzip</span>

<span class="tok-p">(</span><span class="tok-k">define</span> <span class="tok-p">(</span><span class="tok-n">run</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-n">display-command</span> <span class="tok-s2">&quot;Updating Ulquikit&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;-&gt; Current version: &quot;</span> <span class="tok-n">+ulquikit-version+</span><span class="tok-p">))</span>
  <span class="tok-p">(</span><span class="tok-k">let</span> <span class="tok-p">([</span><span class="tok-n">latest-version</span> <span class="tok-p">(</span><span class="tok-n">get-latest-version</span><span class="tok-p">)])</span>
    <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;   Latest version:  &quot;</span> <span class="tok-n">latest-version</span><span class="tok-p">))</span>
    <span class="tok-p">(</span><span class="tok-k">cond</span> <span class="tok-p">[(</span><span class="tok-nb">string=?</span> <span class="tok-n">latest-version</span> <span class="tok-n">+ulquikit-version+</span><span class="tok-p">)</span>
           <span class="tok-p">(</span><span class="tok-nb">newline</span><span class="tok-p">)</span>
           <span class="tok-p">(</span><span class="tok-nb">displayln</span> <span class="tok-p">(</span><span class="tok-n">str</span> <span class="tok-s2">&quot;   Congratulations! You are running the latest version of Ulquikit!&quot;</span><span class="tok-p">))]</span>
          <span class="tok-p">[</span><span class="tok-k">else</span>
           <span class="tok-p">(</span><span class="tok-n">download-and-unzip</span> <span class="tok-n">latest-version</span> <span class="tok-n">+ulquikit-location+</span><span class="tok-p">)])))</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, a little piece of help text is always necessary.</p>
</div>
<div class="listingblock">
<div class="title">file::commands/update.help.txt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="text"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code">Usage: update

Update Ulquikit to latest version.
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc">8. Misc</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">code::use-rackjure</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-kn">#lang </span><span class="tok-nn">rackjure</span>

<span class="tok-p">(</span><span class="tok-n">current-curly-dict</span> <span class="tok-nb">hash</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_quick_installation_script">8.1. Quick installation script</h3>
<div class="paragraph">
<p>This comes in handy at times.  The script assumes that <strong>users have already
installed Racket and Ruby</strong>.</p>
</div>
<div class="paragraph">
<p>The user-friendliness provided by the script is the most important, so let&#8217;s
decide upon how it looks like:</p>
</div>
<div class="listingblock">
<div class="title">file::bin/quick-install.sh</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-c">#!/bin/sh</span>

<span class="tok-c">## include::quick-install/racket</span>

<span class="tok-c">## include::quick-install/ruby</span>

<span class="tok-c">## include::quick-install/asciidoctor</span>

<span class="tok-c">## include::quick-install/rackjure</span>

<span class="tok-c">## include::quick-install/ulquikit</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bourne shell is a horrible language, so even a simple check-and-make-decision
might end up look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span>which some-exec &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo true</span> <span class="tok-o">||</span> <span class="tok-nb">echo false</span><span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;true&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
   <span class="tok-c"># Do-something</span>
<span class="tok-k">fi</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, each part of this quick-install.sh script requires that kind
of check.  Let&#8217;s walk through them one by one.</p>
</div>
<div class="sect3">
<h4 id="_make_sure_racket_is_installed">8.1.1. Make sure Racket is installed</h4>
<div class="paragraph">
<p>This task is simple done by checking whether racket executable is found.
Note that it doesn&#8217;t check Racket version.  The script fails if Racket is not
installed, thus the exit 1 command.</p>
</div>
<div class="listingblock">
<div class="title">code::quick-install/racket</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span>which racket &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo </span>t <span class="tok-o">||</span> <span class="tok-nb">echo </span>f<span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;f&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Racket not found, please install it first.&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   You might refer to your OS&#39;s package manager to install Racket,&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   or download it from: http://racket-lang.org/download/&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   Please MAKE SURE you have Racket 6+.&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Installation aborted.&quot;</span>
    <span class="tok-nb">exit </span>1
<span class="tok-k">else</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Found Racket.  MAKE SURE you have Racket 6+.&quot;</span>
<span class="tok-k">fi</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_ruby_1_9_using_rvm_if_necessary">8.1.2. Install Ruby 1.9 (using RVM) if necessary</h4>
<div class="listingblock">
<div class="title">code::quick-install/ruby</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span>which ruby &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo </span>t <span class="tok-o">||</span> <span class="tok-nb">echo </span>f<span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;f&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Ruby not found.&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   You might refer to your OS&#39;s package manager to install Ruby.&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   However, this script could install Ruby for you using RVM stable.&quot;</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;   Please refer to http://rvm.io for further information.&quot;</span>

    <span class="tok-nb">echo</span> -n <span class="tok-s2">&quot;-&gt; Would you like to install RVM stable single-user mode? [Y/n] &quot;</span>
    <span class="tok-nb">read </span>DO_INSTALL_RVM

    <span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;$DO_INSTALL_RVM&quot;</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&quot;</span> <span class="tok-o">]</span> <span class="tok-se">\</span>
        <span class="tok-o">||</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;$DO_INSTALL_RVM&quot;</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;y&quot;</span> <span class="tok-o">]</span> <span class="tok-se">\</span>
        <span class="tok-o">||</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;$DO_INSTALL_RVM&quot;</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Y&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
        <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Installing Ruby 1.9 and RVM...&quot;</span>

        <span class="tok-se">\c</span>url -sSL https://get.rvm.io <span class="tok-p">|</span> bash -s stable
        <span class="tok-o">[[</span> -f ~/.bashrc <span class="tok-o">]]</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-nb">echo</span> <span class="tok-s1">&#39;source $HOME/.rvm/scripts/rvm&#39;</span> &gt;&gt; ~/.bashrc<span class="tok-o">)</span>
        <span class="tok-o">[[</span> -f ~/.zshrc  <span class="tok-o">]]</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-nb">echo</span> <span class="tok-s1">&#39;source $HOME/.rvm/scripts/rvm&#39;</span> &gt;&gt; ~/.zshrc<span class="tok-o">)</span>
        <span class="tok-nb">source</span> <span class="tok-nv">$HOME</span>/.rvm/scripts/rvm
        rvm install 1.9
        rvm use 1.9 --default
    <span class="tok-k">else</span>
        <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Installation aborted.&quot;</span>
        <span class="tok-nb">exit </span>1
    <span class="tok-k">fi</span>
<span class="tok-k">else</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Found Ruby.  MAKE SURE you have Ruby 1.9+.&quot;</span>
<span class="tok-k">fi</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_asciidoctor_if_necessary">8.1.3. Install AsciiDoctor if necessary</h4>
<div class="listingblock">
<div class="title">code::quick-install/asciidoctor</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span>which asciidoctor &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo </span>t <span class="tok-o">||</span> <span class="tok-nb">echo </span>f<span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;t&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; AsciiDoctor found.&quot;</span>
<span class="tok-k">else</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Installing AsciiDoctor...&quot;</span>
    gem install -V asciidoctor
<span class="tok-k">fi</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_rackjure_if_necessary">8.1.4. Install Rackjure if necessary</h4>
<div class="listingblock">
<div class="title">code::quick-install/rackjure</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span><span class="tok-o">(</span>raco pkg show <span class="tok-p">|</span> grep rackjure<span class="tok-o">)</span> &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo </span>t <span class="tok-o">||</span> <span class="tok-nb">echo </span>f<span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;t&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Rackjure found.&quot;</span>
<span class="tok-k">else</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Installing Rackjure...&quot;</span>
    raco pkg install rackjure
<span class="tok-k">fi</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_ulquikit">8.1.5. Install Ulquikit</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
DOWNLOAD_URL needs to change everytime there&#8217;s new release.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">code::quick-install/ulquikit</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span class="tok-nv">DOWNLOAD_URL</span><span class="tok-o">=</span>https://github.com/cmpitg/ulquikit/releases/download/v0.2.1/ulquikit-v0.2.1.zip

<span class="tok-nb">echo</span> -n <span class="tok-s2">&quot;-&gt; Where would you like to install/update Ulquikit? (default: $HOME/) &quot;</span>
<span class="tok-nb">read </span>ULQUIKIT_DEST
<span class="tok-nb">eval </span><span class="tok-nv">ULQUIKIT_DEST</span><span class="tok-o">=</span><span class="tok-nv">$ULQUIKIT_DEST</span>

<span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;$ULQUIKIT_DEST&quot;</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nv">ULQUIKIT_DEST</span><span class="tok-o">=</span><span class="tok-nv">$HOME</span>/
<span class="tok-k">fi</span>

<span class="tok-nb">cd</span> <span class="tok-nv">$ULQUIKIT_DEST</span>

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Downloading latest version...&quot;</span>
wget -q <span class="tok-s2">&quot;$DOWNLOAD_URL&quot;</span> -O ulquikit.zip

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Unpacking...&quot;</span>
unzip ulquikit.zip

<span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Removing zip file...&quot;</span>
rm -f ulquikit.zip

<span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-sb">`</span>which ulqui &gt;/dev/null 2&gt;<span class="tok-p">&amp;</span><span class="tok-m">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo </span>t <span class="tok-o">||</span> <span class="tok-nb">echo </span>f<span class="tok-sb">`</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;f&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s1">&#39;-&gt; Adding ulquikit/bin to your $PATH&#39;</span>
    <span class="tok-o">[[</span> -f ~/.bashrc <span class="tok-o">]]</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-nb">echo export </span><span class="tok-nv">PATH</span><span class="tok-o">=</span><span class="tok-nv">$ULQUI_DEST</span>/ulquikit/bin:<span class="tok-s1">&#39;$PATH&#39;</span> &gt;&gt; ~/.bashrc<span class="tok-o">)</span>
    <span class="tok-o">[[</span> -f ~/.zshrc <span class="tok-o">]]</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-nb">echo export </span><span class="tok-nv">PATH</span><span class="tok-o">=</span><span class="tok-nv">$ULQUI_DEST</span>/ulquikit/bin:<span class="tok-s1">&#39;$PATH&#39;</span> &gt;&gt; ~/.zshrc<span class="tok-o">)</span>

    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;-&gt; Done!  Enjoy your time with literate programming!&quot;</span>
<span class="tok-k">else</span>
    <span class="tok-nb">echo</span> <span class="tok-s1">&#39;-&gt; Found ulqui command in your $PATH.&#39;</span>
<span class="tok-k">fi</span>

<span class="tok-nb">export </span><span class="tok-nv">PATH</span><span class="tok-o">=</span><span class="tok-nv">$ULQUI_DEST</span>/ulquikit/bin:<span class="tok-nv">$PATH</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_meta_information">9. Other meta-information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I figure out it&#8217;s a good practice to good the application&#8217;s meta-information
into one module.  Currently, it only contain version information and a way to
retrieve location of Ulquikit.</p>
</div>
<div class="listingblock">
<div class="title">file::ulquikit.rkt</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-c1">;; include::license-header</span>

<span class="tok-kn">#lang </span><span class="tok-nn">racket</span>

<span class="tok-p">(</span><span class="tok-k">require</span> <span class="tok-n">racket/path</span><span class="tok-p">)</span>

<span class="tok-p">(</span><span class="tok-k">provide</span> <span class="tok-n">+ulquikit-version+</span>
         <span class="tok-n">+ulquikit-location+</span><span class="tok-p">)</span>

<span class="tok-c1">;; include::ulquikit-version</span>

<span class="tok-c1">;; include::ulquikit-location</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieving location of Ulquikit is simple and straightforward, we&#8217;ll use
find-system-path in combination with syntax-source to do that.  The reason
is that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a file is run as script, syntax-source will return #f, and
find-system-path returns path to the scirpt, which is what we want</p>
</li>
<li>
<p>If a file is run with racket &lt;filename&gt;, syntax-source returns the
filename (what we expect), while find-system-path returns path to racket
executable.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">code::ulquikit-location</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-p">(</span><span class="tok-k">define-values</span> <span class="tok-p">(</span><span class="tok-n">+ulquikit-location+</span> <span class="tok-k">_</span> <span class="tok-n">__</span><span class="tok-p">)</span>
  <span class="tok-p">(</span><span class="tok-nb">split-path</span> <span class="tok-p">(</span><span class="tok-k">or</span> <span class="tok-p">(</span><span class="tok-nb">syntax-source</span> <span class="tok-o">#&#39;</span><span class="tok-n">here</span><span class="tok-p">)</span>
                  <span class="tok-p">(</span><span class="tok-nb">find-system-path</span> <span class="tok-o">&#39;</span><span class="tok-ss">run-file</span><span class="tok-p">))))</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license_header">10. License header</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Ulquikit is distributed under the terms of GPLv3, the license header is
necessary.</p>
</div>
<div class="listingblock">
<div class="title">code::license-header</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="racket"><span class="tok-c1">;;</span>
<span class="tok-c1">;; This file is part of Ulquikit project.</span>
<span class="tok-c1">;;</span>
<span class="tok-c1">;; Copyright (C) 2014 Nguyễn Hà Dương &lt;cmpitg AT gmailDOTcom&gt;</span>
<span class="tok-c1">;;</span>
<span class="tok-c1">;; Ulquikit is free software: you can redistribute it and/or modify it under</span>
<span class="tok-c1">;; the terms of the GNU General Public License as published by the Free</span>
<span class="tok-c1">;; Software Foundation, either version 3 of the License, or (at your option)</span>
<span class="tok-c1">;; any later version.</span>
<span class="tok-c1">;;</span>
<span class="tok-c1">;; Ulquikit is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="tok-c1">;; WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="tok-c1">;; FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more</span>
<span class="tok-c1">;; details.</span>
<span class="tok-c1">;;</span>
<span class="tok-c1">;; You should have received a copy of the GNU General Public License along</span>
<span class="tok-c1">;; with Ulquikit.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="tok-c1">;;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extras">11. Extras</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_utility_functions">12. Utility functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="Utilities.html">Utilities</a>.</p>
</div>
<div class="sect2">
<h3 id="_command_list">12.1. Command list</h3>

</div>
<div class="sect2">
<h3 id="_story_how_the_racket_version_of_ulquikit_was_actually_developed">12.2. Story: How the Racket version of Ulquikit was actually developed</h3>

</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-16 02:32:29 ICT
</div>
</div>
</body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title> Ulquikit
</title>
    <link rel='stylesheet' type='text/css' href='css/bootstrap.min.css' />
<link rel='stylesheet' type='text/css' href='css/github.css' />
<link rel='stylesheet' type='text/css' href='css/pygments.css' />
  </head>
  <body>
    <ul>
<li>
<a href="#toc_0">Ulquikit</a>
<ul>
<li>
<a href="#toc_1">Introduction</a>
<ul>
<li>
<a href="#toc_2">Features</a>
</li>
<li>
<a href="#toc_3">Requirements</a>
</li>
<li>
<a href="#toc_4">Notations</a>
</li>
<li>
<a href="#toc_5">Concepts</a>
</li>
<li>
<a href="#toc_6">Constraints</a>
</li>
<li>
<a href="#toc_7">Configuration</a>
</li>
<li>
<a href="#toc_8">The Markdown language</a>
<ul>
<li>
<a href="#toc_9">Additional features to original Markdown</a>
</li>
<li>
<a href="#toc_10">How it works</a>
</li>
<li>
<a href="#toc_11">Process</a>
</li>
</ul>
</li>
<li>
<a href="#toc_12">Directory structure</a>
</li>
<li>
<a href="#toc_13">Fragmented: Source code generating process</a>
<ul>
<li>
<a href="#toc_14">Extracting snippets</a>
</li>
</ul>
</li>
<li>
<a href="#toc_15">Custom project structure</a>
</li>
<li>
<a href="#toc_16">Emacs supporting</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    <h1 id="toc_0">Ulquikit</h1>

<p>This is full documentation and source code about Ulquikit.  Ulquikit is
written using Ulquikit itself.  On how to use Ulquikit in your project, see
<a href="guide.html">Ulquikit guide</a>.</p>

<h2 id="toc_1">Introduction</h2>

<p>Ulquikit started as a collection of Ruby scripts to:</p>

<ul>
<li><p>Generate source code from a
<a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a> document</p></li>
<li><p>Build software using the generated source code</p></li>
<li><p>Build documentation from Markdown documents</p></li>
<li><p>Build and run tests</p></li>
</ul>

<p>Output is one of the following items:</p>

<ul>
<li><p>A single HTML page with styles</p></li>
<li><p>A PDF file</p></li>
<li><p>An ePub file</p></li>
</ul>

<h3 id="toc_2">Features</h3>

<ul>
<li><p><strong>Fully hackable</strong> source code</p></li>
<li><p><a href="http://en.wikipedia.org/wiki/Convention_over_configuration">Convention over configuration</a></p></li>
<li><p>&quot;Visually pleased&quot;</p></li>
<li><p>Output syntax highlighting</p></li>
<li><p>Generated source code has references to original documentation with the
formats:</p>

<ul>
<li><code class="prettyprint">/path/to/docs:line_number</code></li>
<li><code class="prettyprint">/path/to/docs:line_number_from:line_number_to</code></li>
<li><code class="prettyprint">/path/to/docs:line_number:number_of_lines</code></li>
<li><code class="prettyprint">/path/to/docs:/pattern/</code></li>
<li><code class="prettyprint">/path/to/docs:/pattern_from/,/pattern_to/</code></li>
</ul>

<p>Editors can make use of this pattern to implement code/doc navigation.</p></li>
</ul>

<h3 id="toc_3">Requirements</h3>

<ul>
<li><p>Ruby 1.9+</p></li>
<li><p>Gems:</p>

<ul>
<li><a href="https://github.com/jayferd/rouge">Rouge</a>, a syntax highlighter for Ruby.</li>
<li><a href="https://github.com/vmg/redcarpet">Redcarpet</a> for markdown processing.</li>
<li><a href="http://nokogiri.org/">Nokogiri</a> for HTML/XML processing.</li>
</ul></li>
</ul>

<h3 id="toc_4">Notations</h3>

<p>Aside from usual notation (preformatted text for source code, different text
style for headings and quotes, ...), this document adds a few more notations:</p>

<ul>
<li>Concepts that are valid in Ulquikit (and probably have different meanings
outside) are italicized.</li>
</ul>

<h3 id="toc_5">Concepts</h3>

<p><a name="concept"></a></p>

<ul>
<li><p><em>Snippets</em> refer to <em>code snippets</em> that are used to structure source code.
Each snippet (TODO: for each file? or in the whole project?) has a unique
name and either:</p>

<ul>
<li>defines a potion of code (refered to as <em>code snippets</em>), or</li>
<li>defines a file (refered to as <em>file snippets</em>)</li>
</ul></li>
</ul>

<p><a name="concept-source-doc"></a></p>

<ul>
<li><em>Source doc</em> is a literate document that is used to generate source code and
documentation.</li>
</ul>

<p><a name="concept-gen-doc"></a></p>

<ul>
<li><em>Generated doc</em> is the generated documentation from <em>source doc</em>.</li>
</ul>

<p><a name="concept-gen-code"></a></p>

<ul>
<li><em>Generated code</em> is the generated source code from <em>source doc</em>.</li>
</ul>

<h3 id="toc_6">Constraints</h3>

<ul>
<li><p>Filename contains no space and <code class="prettyprint">:</code>.</p></li>
<li><p>Snippet name contains no space.</p></li>
<li><p>Snippet names are unique.</p></li>
<li><p><strong>Note</strong>: if the code might be polluted by the character sequences that are
used to define snippets, their corresponding regular expressions in config
should be redefined.</p></li>
</ul>

<h3 id="toc_7">Configuration</h3>

<ul>
<li><p>All configuration is managed by a singleton named <code class="prettyprint">UlquiConfig</code>:</p></li>
<li><p>All configuration is modifiable directly by changing the singleton or by
placing a YAML file in the <code class="prettyprint">src/</code> directory.</p>
<pre class="highlight ruby"><span class="o">===</span> <span class="n">config</span><span class="o">-</span><span class="n">declaration</span> <span class="o">===</span>
<span class="k">class</span> <span class="nc">UlquiConfigSingleton</span>
<span class="kp">include</span> <span class="no">Singleton</span>

<span class="o">-</span><span class="p">{</span> <span class="n">config</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">structure</span>             <span class="p">}</span><span class="o">-</span>
<span class="o">-</span><span class="p">{</span> <span class="n">config</span><span class="o">-</span><span class="n">define</span><span class="o">-</span><span class="n">snippet</span><span class="o">-</span><span class="n">regexps</span>        <span class="p">}</span><span class="o">-</span>
<span class="o">-</span><span class="p">{</span> <span class="n">config</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">template</span>              <span class="p">}</span><span class="o">-</span>
<span class="k">end</span>

<span class="no">UlquiConfig</span> <span class="o">=</span> <span class="no">UlquiConfigSingleton</span><span class="p">.</span><span class="nf">instance</span>
<span class="o">======</span>
</pre></li>
<li><p>By default, all regular expressions are defined so that source code part of
the document looks clean and uncluttered:</p>
<pre class="highlight ruby"><span class="o">===</span> <span class="n">config</span><span class="o">-</span><span class="n">define</span><span class="o">-</span><span class="n">snippet</span><span class="o">-</span><span class="n">regexps</span> <span class="o">===</span>
<span class="kp">attr_accessor</span> <span class="ss">:snippet_def_regexp</span><span class="p">,</span> <span class="ss">:file_def_regexp</span><span class="p">,</span> <span class="ss">:snippet_add_regexp</span>

<span class="vi">@snippet_def_regexp</span> <span class="o">=</span> <span class="p">{</span>
<span class="ss">:begin</span>  <span class="o">=&gt;</span> <span class="sr">/=== ([^ ]+) ===$/</span><span class="p">,</span>
<span class="ss">:end</span>    <span class="o">=&gt;</span> <span class="sr">/======$/</span>
<span class="p">}</span>

<span class="vi">@file_def_regexp</span> <span class="o">=</span> <span class="p">{</span>
<span class="ss">:begin</span>  <span class="o">=&gt;</span> <span class="sr">/_____ file: ([^ ]+) _____$/</span><span class="p">,</span>
<span class="ss">:end</span>    <span class="o">=&gt;</span> <span class="sr">/__________$/</span>
<span class="p">}</span>

<span class="vi">@snippet_add_regexp</span> <span class="o">=</span> <span class="sr">/-{ ([^ ]+) }-$/</span>
<span class="o">======</span>
</pre>
<p><em>File snippets</em> has <code class="prettyprint">build_src/</code> as their default directory.</p></li>
</ul>

<h3 id="toc_8">The Markdown language</h3>

<p>Ulquikit supports standard Markdown syntax, and with the help of
<a href="https://github.com/vmg/redcarpet">Redcarpet</a>, it brings additional features
for Markdown documents to have better semantics.</p>

<h4 id="toc_9">Additional features to original Markdown</h4>

<ul>
<li><p>Named anchor:</p>

<ul>
<li>Standard syntax:</li>
</ul>
<pre class="highlight html"><span class="nt">&lt;a</span> <span class="na">name=</span><span class="s">&quot;some-name&quot;</span><span class="nt">&gt;</span>Text<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">name=</span><span class="s">&quot;some-name&quot;</span><span class="nt">&gt;&lt;/a&gt;</span> Text
</pre>
<ul>
<li>Ulquikit syntax:</li>
</ul>
<pre class="highlight plaintext">@{some-name}Text
@{some-name} Text
</pre>
<ul>
<li>Ulquikit&#39;s escape syntax:</li>
</ul>
<pre class="highlight plaintext">\@{some-name}Text
\@{some-name} Text
</pre></li>
</ul>

<h4 id="toc_10">How it works</h4>

<ul>
<li><p>With HTML as Ulquikit&#39;s output, it needs a basic template which defines the
structure of the HTML file.  The template is stored in <code class="prettyprint">src/templates/</code>
directory.</p></li>
<li><p>A Markdown processor is used to render the Markdown file as the <code class="prettyprint">&lt;body&gt;</code> of
the result.</p></li>
</ul>

<h4 id="toc_11">Process</h4>

<ul>
<li><p>Firstly, Ulquikit determines which template is used for the final single
HTML file.  If it finds <code class="prettyprint">templates/main.html</code>, it would read the content of
that file as its main template; otherwise, simple template is used
(<code class="prettyprint">@main_template_content</code>).</p>
<pre class="highlight ruby"><span class="o">===</span> <span class="n">config</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">template</span> <span class="o">===</span>
<span class="kp">attr_accessor</span> <span class="ss">:main_template_file</span><span class="p">,</span> <span class="ss">:main_template_content</span>

<span class="vi">@main_template_file</span> <span class="o">=</span> <span class="s2">&quot;main.html&quot;</span>

<span class="vi">@main_template_content</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">try_read_file</span> <span class="vi">@main_template_content</span>
<span class="vi">@main_template_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;%{title}&lt;/title&gt;
  %{css}
&lt;/head&gt;
&lt;body&gt;
  %{content}
  %{js}
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span> <span class="k">if</span> <span class="vi">@main_template_content</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<span class="o">======</span>
</pre></li>
<li><p>Also, the function to process main template is </p></li>
<li><p>Ulquikit reads all templates in <code class="prettyprint">src/templates/</code>.</p></li>
<li><p>Then, all Markdown files are read and rendered using Redcarpet.  Variable
definition part is parsed and all variables are stored in a hash.</p></li>
</ul>

<h3 id="toc_12">Directory structure</h3>
<pre class="highlight plaintext">&lt;project-name&gt;/
  src/
    images/
    scripts/
    styles/
    templates/
    config/
      custom-commands.rb
      pre-processing.rb
      post-processing.rb
    somefile.md
  COPYING
  README
</pre>
<ul>
<li><p>The above structure is completely configurable (what&#39;s the point of being
fully hackable if it&#39;s not? (-:).  However, it&#39;s strongly advised not to
change:</p>

<p>TODO: Review the following part</p>
<pre class="highlight ruby"><span class="o">===</span> <span class="n">config</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">structure</span> <span class="o">===</span>

<span class="k">class</span> <span class="nc">UlquiConfigSingleton</span>
<span class="kp">attr_accessor</span> <span class="ss">:project_structure</span>

<span class="n">project_structure</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:main_dirs</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:src</span>          <span class="o">=&gt;</span> <span class="s1">'src'</span><span class="p">,</span>
    <span class="ss">:build</span>        <span class="o">=&gt;</span> <span class="s1">'build'</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="ss">:template</span>       <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:path</span>         <span class="o">=&gt;</span> <span class="s1">'src/templates'</span><span class="p">,</span>
    <span class="ss">:default</span>      <span class="o">=&gt;</span> <span class="s1">'main.html'</span>
    <span class="ss">:action</span>       <span class="o">=&gt;</span> <span class="no">Producer</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:read_template_html</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="ss">:images</span>         <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:src</span>          <span class="o">=&gt;</span> <span class="s1">'images'</span><span class="p">,</span>
    <span class="ss">:output</span>       <span class="o">=&gt;</span> <span class="s1">'img'</span>
  <span class="p">},</span>

  <span class="ss">:js</span>             <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:src</span>          <span class="o">=&gt;</span> <span class="s1">'scripts'</span><span class="p">,</span>
    <span class="ss">:output</span>       <span class="o">=&gt;</span> <span class="s1">'js'</span><span class="p">,</span>
    <span class="ss">:action</span>       <span class="o">=&gt;</span> <span class="no">Producer</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:compile_js</span><span class="p">),</span>
    <span class="ss">:file_regexp</span>  <span class="o">=&gt;</span> <span class="sr">/\.js$/</span>
  <span class="p">},</span>

  <span class="ss">:css</span>            <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:src</span>          <span class="o">=&gt;</span> <span class="s1">'styles'</span><span class="p">,</span>
    <span class="ss">:output</span>       <span class="o">=&gt;</span> <span class="s1">'css'</span><span class="p">,</span>
    <span class="ss">:action</span>       <span class="o">=&gt;</span> <span class="no">Producer</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:compile_css</span><span class="p">),</span>
    <span class="ss">:file_regexp</span>  <span class="o">=&gt;</span> <span class="sr">/\.css$/</span>
  <span class="p">},</span>

  <span class="ss">:md</span>             <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:src</span>          <span class="o">=&gt;</span> <span class="s1">'./'</span><span class="p">,</span>
    <span class="ss">:output</span>       <span class="o">=&gt;</span> <span class="s1">'./'</span><span class="p">,</span>
    <span class="ss">:action</span>       <span class="o">=&gt;</span> <span class="no">Producer</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:compile_md</span><span class="p">),</span>
    <span class="ss">:file_regexp</span>  <span class="o">=&gt;</span> <span class="sr">/\.(html|pdf|epub)$/</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="k">end</span>
<span class="o">======</span>

</pre></li>
</ul>

<h3 id="toc_13">Fragmented: Source code generating process</h3>

<p>Source code generating process could be described is the flow below:</p>
<pre class="highlight ruby"><span class="n">____</span> <span class="ss">file: </span><span class="p">.</span><span class="nf">/</span><span class="n">gen_source_code</span><span class="p">.</span><span class="nf">rb</span> <span class="n">____</span>

<span class="o">-</span><span class="p">{</span> <span class="n">gen</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">requires</span> <span class="p">}</span>

<span class="o">-</span><span class="p">{</span> <span class="n">gen</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">extract</span><span class="o">-</span><span class="n">snippets</span>    <span class="p">}</span><span class="o">-</span>
<span class="o">-</span><span class="p">{</span> <span class="n">gen</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">inserting</span><span class="o">-</span><span class="n">snippets</span>  <span class="p">}</span><span class="o">-</span>
<span class="o">-</span><span class="p">{</span> <span class="n">gen</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">create</span><span class="o">-</span><span class="n">files</span>        <span class="p">}</span><span class="o">-</span>
<span class="n">__________</span>
</pre>
<p>The regular expression for defining file snippet might not look nice, you can
always change it (TODO: Make reference to <code class="prettyprint">file_def_regexp</code> part).</p>

<h4 id="toc_14">Extracting snippets</h4>

<p>Snippets are read from all Markdown determine by the list of  <code class="prettyprint">UlquiConfig[:]</code></p>

<h3 id="toc_15">Custom project structure</h3>

<p>Useful for projects such an an Emacs Lisp or Racket package, the project structure is
mostly flattened.</p>

<p>Ulquikit supports customizing project structure in your <code class="prettyprint">./config.json</code> (TODO:
Make reference to the section describing <code class="prettyprint">config.json</code>) file.</p>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">&quot;output-source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./&quot;</span><span class="p">,</span><span class="w">
  </span><span class="s2">&quot;output-doc&quot;</span><span class="p">:</span><span class="w">    </span><span class="s2">&quot;./&quot;</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h3 id="toc_16">Emacs supporting</h3>

<ul>
<li><p>Multi-major mode</p></li>
<li><p>Snippets</p>
<pre class="highlight plaintext">-new-frag
-new-file
-add-frag
</pre></li>
<li><p>Code navigation based on pattern</p></li>
</ul>

    <script type='text/javascript' src='js/bootstrap.min.js'></script>
  </body>
</html>
